!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports=JSON.parse('{"supportedLanguages":["en_US"],"languages":{"en_US":"English","de_DE":"Deutsch","zh_CN":"简体中文","ja_JP":"日本語","ko_KR":"한국어","zh_TW":"繁體中文","ru_RU":"Русский","fr_FR":"Français"},"title":{"en_US":"CrossCode Area Editor","ko_KR":"크로스코드 지역 에디터"},"floor.upper":{"en_US":"F","de_DE":"E","zh_CN":"层","ja_JP":"階","ko_KR":"층","zh_TW":"層"},"floor.ground":{"en_US":"GF","de_DE":"EG","zh_CN":"基层","ja_JP":"地階","ko_KR":"지상","zh_TW":"基層"},"floor.lower":{"en_US":"U","de_DE":"U","zh_CN":"U","ja_JP":"地下","ko_KR":"U","zh_TW":"U"},"untitled":{"en_US":"untitled","de_DE":"unbetitelt","zh_CN":"未命名","ja_JP":"無題","ko_KR":"미정","zh_TW":"未命名"},"inspector":{"en_US":"Inspector","ko_KR":"인스펙터"},"inspector.select":{"en_US":"Select"},"inspector.tabs.transfer":{"en_US":"Transfer"},"inspector.tabs.area":{"en_US":"Area"},"inspector.tabs.floor":{"en_US":"Floor"},"inspector.tabs.selection":{"en_US":"Selection"},"inspector.transfer":{"en_US":"Transfer Data"},"inspector.transfer.note":{"en_US":"Here is where you can import existing data or export data from the editor for use in-game. To create a new area, go into the \\"Area\\" tab and set the area\'s dimensions there. Here, you can import an existing area by either copying and pasting the data or by uploading it. To export the area from the editor, you can either copy it from the text field or download it."},"inspector.transfer.textfield.paste":{"en_US":"Transferred into editor!"},"inspector.transfer.textfield.copy":{"en_US":"Copy"},"inspector.transfer.textfield.copy.status":{"en_US":"Copied to clipboard!"},"inspector.transfer.textfield.placeholder":{"en_US":"Paste JSON here."},"inspector.transfer.upload.note":{"en_US":"You can also drag and drop an area JSON file anywhere to load it into the editor."},"inspector.transfer.download":{"en_US":"Download"},"inspector.area":{"en_US":"Area Settings"},"inspector.area.width":{"en_US":"Width"},"inspector.area.height":{"en_US":"Height"},"inspector.area.offsetX":{"en_US":"Offset X"},"inspector.area.offsetY":{"en_US":"Offset Y"},"inspector.area.confirm":{"en_US":"Confirm"},"inspector.area.defaultFloor":{"en_US":"Default Floor"},"inspector.area.defaultFloor.note":{"en_US":"This setting determines the first floor you see when viewing this area from another area."},"inspector.area.floors":{"en_US":"Floors"},"inspector.area.palette":{"en_US":"Generate New Palette"},"inspector.area.note":{"en_US":"Note: Area metadata is stored in \\"assets/data/database.json/areas/<area>\\". This is where properties like the amount of chests in the area, names/descriptions, and its position on the global map are stored. The area data structure itself is for storing the grid and any other grid-specific data like maps, connections, icons, and landmarks."},"inspector.floor":{"en_US":"Floor Settings"},"inspector.floor.level":{"en_US":"Level"},"inspector.floor.level.note":{"en_US":"The level property only determines the display of this floor in the floor buttons. So you can have -2 then -4, which will show up in that order. A default floor property that doesn\'t match anything will just show a blank screen until you select a floor."},"inspector.floor.handle":{"en_US":"Custom Handler"},"inspector.floor.handle.note":{"en_US":"This will override the level property so instead of displaying \\"F5\\", you can instead display \\"F??\\" with this setting."},"inspector.floor.handle.add":{"en_US":"Add"},"inspector.floor.handle.remove":{"en_US":"Remove"},"inspector.floor.maps":{"en_US":"Maps"},"inspector.floor.connections":{"en_US":"Connections"},"inspector.floor.icons":{"en_US":"Icons"},"inspector.floor.landmarks":{"en_US":"Landmarks"},"inspector.floor.selected":{"en_US":"Selected Index"},"inspector.selection":{"en_US":"Current Selection"},"inspector.selection.map":{"en_US":"Map"},"inspector.selection.map.path":{"en_US":"Path"},"inspector.selection.map.name":{"en_US":"Map Name"},"inspector.selection.map.note":{"en_US":"The path requires a specific format to work properly. For example, \\"arid.town-1\\", which points to \\"assets/data/maps/arid/town-1.json\\"."},"inspector.selection.connection":{"en_US":"Connection"},"inspector.selection.connection.position":{"en_US":"Position"},"inspector.selection.connection.direction":{"en_US":"Direction"},"inspector.selection.connection.size":{"en_US":"Size"},"inspector.selection.connection.maps":{"en_US":"Bound Maps"},"inspector.selection.connection.condition":{"en_US":"Condition (optional)"},"inspector.selection.icon":{"en_US":"Icon"},"inspector.selection.icon.position":{"en_US":"Position"},"inspector.selection.icon.icon":{"en_US":"Icon"},"inspector.selection.icon.map":{"en_US":"Bound Map"},"inspector.selection.icon.data":{"en_US":"Icon Metadata"},"inspector.selection.icon.data.area":{"en_US":"Area"},"inspector.selection.icon.data.map":{"en_US":"Map"},"inspector.selection.icon.data.note":{"en_US":"This is required for area pointer icons. For the area field, put in the area identifier (like \\"arid-dng-2\\") and the map that it\'s pointing to (like \\"arid-dng.first.room-01\\")."},"inspector.selection.landmark":{"en_US":"Landmark"},"inspector.selection.landmark.position":{"en_US":"Position"},"inspector.selection.landmark.id":{"en_US":"ID"},"inspector.selection.landmark.map":{"en_US":"Bound Map"},"preferences":{"en_US":"Preferences"},"preferences.language":{"en_US":"Language"},"preferences.language.note":{"en_US":"This setting will be used to determine both the language that will appear in this program (if it\'s supported) as well as the default language that appears when you edit a map\'s name. Below, you\'ll see two fields: The first is a dropdown menu of all the fully-supported languages. The second is a text field where you can enter in any language code such as \\"en_US\\" in order to automatically switch to that language when editing map names. The two are intertwined."},"preferences.language.submit":{"en_US":"Submit"},"preferences.language.success":{"en_US":"Successfully set your language to %language_name% (%language_tag%)! Reload the page for these changes to take place."},"preferences.language.failure":{"en_US":"Failed to set your language to %language_name% (%language_tag%)! Your browser most likely doesn\'t support the local storage module."}}')},function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"VIEWS",(function(){return ee})),n.d(o,"currentFloor",(function(){return ne})),n.d(o,"currentFloorIndex",(function(){return oe})),n.d(o,"currentMode",(function(){return ie})),n.d(o,"render",(function(){return ae})),n.d(o,"createArea",(function(){return re})),n.d(o,"loadArea",(function(){return le})),n.d(o,"generateNewPalette",(function(){return de})),n.d(o,"switchFloor",(function(){return ce})),n.d(o,"setFloorView",(function(){return he})),n.d(o,"addFloor",(function(){return ue})),n.d(o,"removeFloor",(function(){return fe})),n.d(o,"swapFloors",(function(){return pe})),n.d(o,"addMap",(function(){return ge})),n.d(o,"removeMap",(function(){return ve})),n.d(o,"swapMaps",(function(){return me})),n.d(o,"addConnection",(function(){return we})),n.d(o,"removeConnection",(function(){return xe})),n.d(o,"swapConnections",(function(){return ye})),n.d(o,"addIcon",(function(){return be})),n.d(o,"removeIcon",(function(){return Se})),n.d(o,"swapIcons",(function(){return Te})),n.d(o,"addLandmark",(function(){return _e})),n.d(o,"removeLandmark",(function(){return Ie})),n.d(o,"swapLandmarks",(function(){return Ce})),n.d(o,"setTile",(function(){return Ee})),n.d(o,"setBox",(function(){return Ue})),n.d(o,"setBoxPreview",(function(){return ke})),n.d(o,"resizeArea",(function(){return Le})),n.d(o,"moveConnection",(function(){return Re})),n.d(o,"rotateConnection",(function(){return Ne})),n.d(o,"resizeConnection",(function(){return Oe})),n.d(o,"moveIcon",(function(){return Fe})),n.d(o,"select",(function(){return Ae})),n.d(o,"selectByIndex",(function(){return Me})),n.d(o,"highlight",(function(){return Pe})),n.d(o,"panView",(function(){return ze})),n.d(o,"resetView",(function(){return De})),n.d(o,"setView",(function(){return je})),n.d(o,"switchZoom",(function(){return Ye}));var i=new class{constructor(){this.palette=[0]}getColor(e,t=!1){if(e<0)throw new RangeError(`Index out of bounds at getColor(${e})!`);e in this.palette||(this.palette[e]=Math.floor(16777216*Math.random()));const n=this.palette[e];return"#"+(t?function(e){if(e>16777215||e<0)throw new RangeError(`Color "${e}" provided to getInverse is not a valid RGB value!`);return 16777215&~e}(n):n).toString(16).padStart(6,"0")}generateNewPalette(){this.palette.splice(1)}};class s{constructor(e,t){this.width=e,this.height=t,this.data=new Uint8Array(e*t)}static from(e){var t;const n=e.length,o=e[0].length,i=new s(o,n);for(let s=0;s<n;s++){e[s].length!==o&&console.warn("This matrix does not have the same width throughout!",e);for(let n=0;n<o;n++)i.set(n,s,null!==(t=e[s][n])&&void 0!==t?t:0)}return i}get(e,t){if(!(e>=this.width||e<0||t>=this.height||t<0))return this.data[this.width*t+e]}set(e,t,n){if(e>=this.width||e<0||t>=this.height||t<0)throw new RangeError(`Index out of bounds! Called (${e}, ${t}) of width ${this.width} x height ${this.height}.`);this.data[this.width*t+e]=n}resize(e,t,n=0,o=0){const i=new Uint8Array(e*t);for(let s=0;s<this.data.length;s++){const a=s%this.width+n,r=Math.floor(s/this.width)+o;a>=0&&a<e&&r>=0&&r<t&&(i[e*r+a]=this.data[s])}this.data=i,this.width=e,this.height=t}iterate(e){for(let t=0;t<this.data.length;t++){const n=e(t%this.width,Math.floor(t/this.width),this.data[t]);"number"==typeof n&&(this.data[t]=n)}}getWidth(){return this.width}getHeight(){return this.height}toJSON(){const e=new Array(this.height);for(let t=0;t<this.height;t++)e[t]=Array.from(this.data.slice(this.width*t,this.width*(t+1)));return e}}class a{constructor(e){this.element=e}attach(e){return this.element.appendChild(e.element),this}attachElement(e){return this.element.appendChild(e),this}attachTo(e){e.appendChild(this.element)}}class r extends a{constructor(){super(document.createElement("div")),this.enabled=!0,this.setDisplay(!1)}setDisplay(e){const t=null!=e?e:!this.enabled;return this.enabled=t,this.element.style.display=t?"block":"none",this}getElement(){return this.element}}class l extends a{constructor(e,t=!1){var n,o,i;super(document.createElement("table")),this.tbody=document.createElement("tbody"),this.element.appendChild(this.tbody),this.button=f("button",{text:"+",events:{click:()=>this.addRow(!0)}}),this.onadd=null!==(n=null==e?void 0:e.onadd)&&void 0!==n?n:()=>{},this.onremove=null!==(o=null==e?void 0:e.onremove)&&void 0!==o?o:()=>{},this.onswap=null!==(i=null==e?void 0:e.onswap)&&void 0!==i?i:()=>{},this.tmpIndex=-1,t&&this.element.classList.add("reverse")}addRow(e=!1){const t=this,n=this.element.insertRow(),o=n.insertCell(),i=n.insertCell(),s=n.insertCell();o.classList.add("collapse"),o.appendChild(f("button",{text:"-",events:{click(){var e;const n=null===(e=this.parentElement)||void 0===e?void 0:e.parentElement;if(!n)throw"This event was called outside of a table!";const o=n.rowIndex;t.tbody.removeChild(n),t.onremove(o)}}})),i.classList.add("collapse"),i.appendChild(f("input",{attributes:{type:"checkbox"},events:{click(){var e;const n=null===(e=this.parentElement)||void 0===e?void 0:e.parentElement;if(!n)throw"This event was called outside of a table!";const o=n.rowIndex;if(-1===t.tmpIndex)t.tmpIndex=o;else{t.onswap(t.tmpIndex,o);const e=t.element.rows[t.tmpIndex];e.children[1].children[0].checked=!1,this.checked=!1,t.tmpIndex=-1;const i=f("span");n.after(i),e.after(n),i.after(e),t.tbody.removeChild(i)}}}}));const a=f("div");s.appendChild(a),this.onadd(a,n.rowIndex,e)}getRow(e){return this.element.rows[e]}clearRows(){for(let e=this.element.rows.length;e--;)this.element.deleteRow(0)}getTable(){return this.element}}function d(e,t,n){void 0!==n&&n<e.length?e.splice(n,0,t):e.push(t)}function c(e,t,n){e.splice(n,0,e.splice(t,1)[0])}function h(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function u(e,t){void 0!==t?e.splice(t,1):e.pop()}function f(e,t){const n=document.createElement(e);if((null==t?void 0:t.text)&&(n.innerText=t.text),null==t?void 0:t.classes)for(const e of t.classes)n.classList.add(e);if(null==t?void 0:t.attributes)for(const e in t.attributes)n.setAttribute(e,t.attributes[e]);if(null==t?void 0:t.events)for(const e in t.events)n.addEventListener(e,t.events[e]);if(null==t?void 0:t.append)if(Array.isArray(t.append))for(const e of t.append)n.appendChild(e);else n.appendChild(t.append);return n}var p=new class{constructor(){var e,t;let n;try{n=JSON.parse(null!==(e=window.localStorage.getItem("CCAE"))&&void 0!==e?e:"{}")}catch(e){n={}}this.language=null!==(t=n.language)&&void 0!==t?t:"en_US",this.save()}set(e,t){return e in this&&(this[e]=t,this.save(),!0)}save(){window.localStorage.setItem("CCAE",JSON.stringify(this))}},g=n(0);class v{constructor(e){if(this.languages={en_US:""},e)for(const t in e)"langUid"!==t&&(this.languages[t]=e[t])}get(e=p.language){var t;return e in this.languages?this.languages[e]:null!==(t=this.languages.en_US)&&void 0!==t?t:""}getClean(e=p.language){let t=this.get(e);return/<<[AC]/g.test(t)&&(t=t.substring(0,t.search(/<<[AC]/g))),t}toJSON(){return this.languages}}function m(e){return e in g.languages?x.languages.get(e):e}const w=g.supportedLanguages;delete g.supportedLanguages;const x={};for(const e in g)x[e]=new v(g[e]);function y(e,t){const n=x[e];return n?n.get(t):"N/A"}document.title=y("title");class b{constructor(e,t,n){if(this.level=e,t.constructor===s)this.tiles=t;else{if(t.constructor!==Number||!n)throw`Invalid constructor call to Floor! new Floor(${e}, ${t}, ${n})`;this.tiles=new s(t,n)}this.icons=[],this.maps=[],this.connections=[],this.landmarks=[]}static from(e){const t=new b(e.level,s.from(e.tiles));e.handle&&(t.handle=new v(e.handle));for(const n of e.maps)t.maps.push(new S(n));for(const n of e.connections)t.connections.push(new T(n));for(const n of e.icons)t.icons.push(new _(n));for(const n of e.landmarks)t.landmarks.push(new I(n));return t}setTile(e,t,n){if(n>this.maps.length)throw`Error: Attempted to place a tile with the value of ${n}, but the maximum allowed index is ${this.maps.length}! If you want to use more maps, you have to do so by calling Floor.addMap(...)!`;this.tiles.set(e,t,n)}getFloorName(){return this.handle?this.handle.getClean():0===this.level?y("floor.ground"):this.level>0?Math.abs(this.level)+y("floor.upper"):this.level<0?y("floor.lower")+Math.abs(this.level):"N/A"}render(e,t){if(st.setRenderingMode(!1),e)if(st.generateTilesAdvanced(this.tiles,null==t?void 0:t.isolate),st.setRenderingMode(!0),null==t?void 0:t.debugConnectionsMode)for(let e=0;e<this.connections.length;e++){const n=this.connections[e];void 0!==t.select&&e!==t.select||st.drawDebugConnection(n.tx,n.ty,"VERTICAL"===n.dir,n.size)}else if(null==t?void 0:t.isolate){for(let e=0;e<this.icons.length;e++){const n=this.icons[e];!t.isolate.includes(n.map+1)||void 0!==t.select&&e!==t.select||st.drawIcon(n.x,n.y,n.icon)}for(let e=0;e<this.landmarks.length;e++){const n=this.landmarks[e];t.isolate.includes(n.map+1)&&st.drawIcon(n.x,n.y,"landmark")}}else{for(const e of this.connections)st.drawConnection(e.tx,e.ty,"VERTICAL"===e.dir,e.size);for(const e of this.icons)st.drawIcon(e.x,e.y,e.icon);for(const e of this.landmarks)st.drawIcon(e.x,e.y,"landmark")}else st.generateTiles(this.tiles,null==t?void 0:t.isolate);st.setRenderingMode(!0)}resize(e,t,n=0,o=0){if(this.tiles.resize(e,t,n,o),0!==n||0!==o){const e=[],t=[],i=[];for(let t=0;t<this.connections.length;t++){const i=this.connections[t];i.tx+=n,i.ty+=o,(i.tx<0||i.ty<0)&&e.push(t)}for(let e=0;e<this.icons.length;e++){const i=this.icons[e];i.x+=8*n,i.y+=8*o,(i.x<0||i.y<0)&&t.push(e)}for(let e=0;e<this.landmarks.length;e++){const t=this.landmarks[e];t.x+=8*n,t.y+=8*o,(t.x<0||t.y<0)&&i.push(e)}for(const t of e)this.removeConnection(t);for(const e of t)this.removeIcon(e);for(const e of i)this.removeLandmark(e)}}addMap(e,t,n){d(this.maps,new S({path:e,name:t}),n)}moveMap(e,t){c(this.maps,e,t)}swapMaps(e,t){h(this.maps,e,t);const n=e+1,o=t+1;this.tiles.iterate((e,t,i)=>n===i?o:o===i?n:i)}removeMap(e){u(this.maps,e);const t=(null!=e?e:this.maps.length-1)+1;this.tiles.iterate((e,n,o)=>o===t?0:o>t?o-1:o);for(const e of this.connections)e.map1--,e.map2--;for(const e of this.icons)e.map--;for(const e of this.landmarks)e.map--}addConnection(e,t,n,o,i,s,a){d(this.connections,new T({tx:e,ty:t,dir:s?"VERTICAL":"HORIZONTAL",size:i,map1:n,map2:o}),a)}moveConnection(e,t){c(this.connections,e,t)}swapConnections(e,t){h(this.connections,e,t)}removeConnection(e){u(this.connections,e)}addIcon(e,t,n,o,i){d(this.icons,new _({icon:e,x:t,y:n,map:o}),i)}moveIcon(e,t){c(this.icons,e,t)}swapIcons(e,t){h(this.icons,e,t)}removeIcon(e){u(this.icons,e)}addLandmark(e,t,n,o,i){d(this.landmarks,new I({id:e,x:t,y:n,map:o}),i)}moveLandmark(e,t){c(this.landmarks,e,t)}swapLandmarks(e,t){h(this.landmarks,e,t)}removeLandmark(e){u(this.landmarks,e)}getMapIndexByPosition(e,t){var n;return null!==(n=this.tiles.get(e,t))&&void 0!==n?n:-1}getConnectionIndexByPosition(e,t){for(let n=0;n<this.connections.length;n++){const o=this.connections[n],i="VERTICAL"===o.dir,s=o.tx,a=o.ty,r=i?s+o.size-1:s+1,l=i?a+1:a+o.size-1;if(e>=s&&e<=r&&t>=a&&t<=l)return n}return-1}getIconIndexByPosition(e,t){for(let n=0;n<this.icons.length;n++){const o=this.icons[n],[i,s,a,r]=st.getIconBounds(o.x,o.y,o.icon);if(e>=i&&e<=a&&t>=s&&t<=r)return n}for(let n=0;n<this.landmarks.length;n++){const o=this.landmarks[n],[i,s,a,r]=st.getIconBounds(o.x,o.y,"landmark");if(e>=i&&e<=a&&t>=s&&t<=r)return~n-1}return-1}getMapByIndex(e){return this.maps[e]}getConnectionByIndex(e){return this.connections[e]}getIconByIndex(e){return this.icons[e]}getLandmarkByIndex(e){return this.landmarks[e]}}class S{constructor(e){var t;this.path=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"",this.name=new v(null==e?void 0:e.name)}}class T{constructor(e){var t,n,o,i,s;this.tx=null!==(t=null==e?void 0:e.tx)&&void 0!==t?t:0,this.ty=null!==(n=null==e?void 0:e.ty)&&void 0!==n?n:0,this.dir=["HORIZONTAL","VERTICAL"].includes(null==e?void 0:e.dir)?null==e?void 0:e.dir:"HORIZONTAL",this.size=null!==(o=null==e?void 0:e.size)&&void 0!==o?o:1,this.map1=null!==(i=null==e?void 0:e.map1)&&void 0!==i?i:0,this.map2=null!==(s=null==e?void 0:e.map2)&&void 0!==s?s:0,this.condition=null==e?void 0:e.condition,this.offset=null==e?void 0:e.offset}}class _{constructor(e){var t,n,o,i;this.icon=null!==(t=null==e?void 0:e.icon)&&void 0!==t?t:"chest",this.x=null!==(n=null==e?void 0:e.x)&&void 0!==n?n:0,this.y=null!==(o=null==e?void 0:e.y)&&void 0!==o?o:0,this.map=null!==(i=null==e?void 0:e.map)&&void 0!==i?i:0,this.data=null==e?void 0:e.data}}class I{constructor(e){var t,n,o,i;this.id=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"",this.x=null!==(n=null==e?void 0:e.x)&&void 0!==n?n:0,this.y=null!==(o=null==e?void 0:e.y)&&void 0!==o?o:0,this.map=null!==(i=null==e?void 0:e.map)&&void 0!==i?i:0}}let C="area.json";function E(e){try{Q(new G(JSON.parse(e)))}catch(e){Q(new G)}}const U={textfield:f("input",{attributes:{type:"text",placeholder:y("inspector.transfer.textfield.placeholder")},events:{input:function(){E(this.value),this.blur(),this.value="",this.placeholder=y("inspector.transfer.textfield.paste"),setTimeout(()=>this.placeholder=y("inspector.transfer.textfield.placeholder"),1500)}}})};var k,L=(new r).attachElement(f("div",{text:y("inspector.transfer.note")})).attachElement(f("div",{append:[U.textfield,f("button",{text:y("inspector.transfer.textfield.copy"),events:{click:(k=U.textfield,function(){q&&(k.value=JSON.stringify(q),k.select(),k.setSelectionRange(0,99999),document.execCommand("copy"),k.blur(),k.value="",k.placeholder=y("inspector.transfer.textfield.copy.status"),setTimeout(()=>k.placeholder=y("inspector.transfer.textfield.placeholder"),1500))})}})]})).attachElement(f("div",{append:[f("input",{attributes:{type:"file"},events:{change:function(){var e;const t=null===(e=this.files)||void 0===e?void 0:e[0];if(null==t?void 0:t.name.endsWith(".json")){const e=new FileReader;C=t.name,e.readAsText(t,"UTF-8"),e.onload=()=>{E(e.result)}}}}}),f("span",{text:y("inspector.transfer.upload.note")})]})).attachElement(f("div",{append:f("button",{text:y("inspector.transfer.download"),events:{click:function(){if(q){const e=document.createElement("a");e.download=C,e.href=window.URL.createObjectURL(new Blob([JSON.stringify(q)],{type:"text/plain"})),e.click(),e.remove()}}}})})).setDisplay();const R={width:f("input",{attributes:{type:"number",value:"1"}}),height:f("input",{attributes:{type:"number",value:"1"}}),offsetX:f("input",{attributes:{type:"number"}}),offsetY:f("input",{attributes:{type:"number"}}),defaultFloor:f("input",{attributes:{type:"number"},events:{input(){q?q.defaultFloor=parseInt(this.value):this.value=""}}})},N=new l({onadd:(e,t,n)=>{var o;n&&ue(),e.appendChild(f("button",{text:(null!==(o=null==q?void 0:q.getFloorByIndex(t).getFloorName())&&void 0!==o?o:"N/A")+" ",events:{click(){var e,t;const n=null===(t=null===(e=null==this?void 0:this.parentElement)||void 0===e?void 0:e.parentElement)||void 0===t?void 0:t.parentElement;if(!n)throw"This event was called outside of a table!";he(n.rowIndex)}}}))},onremove:fe,onswap:pe},!0);var O=(new r).attachElement(f("div",{append:[f("span",{text:y("inspector.area.width")+" "}),R.width,f("span",{text:" "+y("inspector.area.height")+" "}),R.height,f("br"),f("span",{text:y("inspector.area.offsetX")+" "}),R.offsetX,f("span",{text:" "+y("inspector.area.offsetY")+" "}),R.offsetY,f("br"),f("button",{text:y("inspector.area.confirm"),events:{click(){Le({width:parseInt(R.width.value)||void 0,height:parseInt(R.height.value)||void 0,offsetX:parseInt(R.offsetX.value)||void 0,offsetY:parseInt(R.offsetY.value)||void 0}),R.offsetX.value="",R.offsetY.value=""}}})]})).attachElement(f("div",{append:[f("span",{text:y("inspector.area.defaultFloor")+" "}),R.defaultFloor,f("p",{text:y("inspector.area.defaultFloor.note")})]})).attachElement(f("div",{append:[f("h2",{text:y("inspector.area.floors")}),N.getTable(),N.button]})).attachElement(f("div",{append:f("button",{text:y("inspector.area.palette"),events:{click:de}})})).attachElement(f("div",{append:f("p",{text:y("inspector.area.note")})}));const F=new class extends a{constructor(e,t,n){super(document.createElement("div"));const o=this;this.input=f("input",{attributes:{type:"text",placeholder:null!=t?t:""},events:{input(){o.langlabel.languages[o.tag]=this.value,n&&n(this.value,o.tag)}}}),this.menu=f("select",{events:{change(){o.tag=this.value,o.input.value=o.langlabel.get(o.tag)}}}),this.langlabel=null!=e?e:new v,this.tag=p.language,this.element.appendChild(this.input),this.element.appendChild(this.menu),this.createMenu()}setLangLabel(e){for(this.langlabel=e;this.menu.firstChild;)this.menu.removeChild(this.menu.firstChild);this.input.value="",this.createMenu()}createMenu(){let e=!1;for(const t in this.langlabel.languages){const n=f("option",{text:m(t),attributes:{value:t}});t===p.language&&(this.input.value=this.langlabel.get(t),n.selected=!0,e=!0),this.menu.appendChild(n)}if(!e){const e=p.language,t=f("option",{text:m(e),attributes:{value:e}});t.selected=!0,this.menu.appendChild(t)}}getElement(){return this.element}}(new v,"",P),A={level:f("input",{attributes:{type:"number"},events:{input(){ne&&q?(ne.level=parseInt(this.value),P()):this.value=""}}}),button:f("button",{text:y("inspector.floor.handle.add"),events:{click(){if(ne){let e=ne.handle;e?(ne.handle=void 0,B()):(e=new v,ne.handle=e,M(e)),P()}}}}),container:F.getElement(),selected:f("span",{text:"N/A"})};function M(e){F.setLangLabel(e),A.container.style.display="block",A.button.innerText=y("inspector.floor.handle.remove")}function B(){A.container.style.display="none",A.button.innerText=y("inspector.floor.handle.add")}function P(){var e,t;if(!ne)throw"setFloorHeader was called in the wrong context!";const n=N.getRow(oe),o=null===(t=null===(e=null==n?void 0:n.children[2])||void 0===e?void 0:e.children[0])||void 0===t?void 0:t.children[0];if(!o)throw"Invalid span type assertion at inspector.elements.level.events.input!";o.innerText=ne.getFloorName()+" "}const z=new l({onadd:(e,t,n)=>{var o;n&&ge(),e.appendChild(f("button",{text:(null===(o=ne)||void 0===o?void 0:o.maps[t].name.getClean())||y("untitled"),events:{mousedown(e){var t,n;if(ie===ee.TILES){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Me(o.rowIndex+1),2===e.button&&Pe()}},mouseup:()=>ae(),mouseleave:()=>ae(),contextmenu:e=>e.preventDefault()}}))},onremove:ve,onswap:me}),D=new l({onadd:(e,t,n)=>{var o,i,s;n&&we();const a=null===(o=ne)||void 0===o?void 0:o.connections[t];e.appendChild(f("button",{text:`(${null!==(i=null==a?void 0:a.tx)&&void 0!==i?i:0}, ${null!==(s=null==a?void 0:a.ty)&&void 0!==s?s:0})`,events:{mousedown(e){var t,n;if(ie===ee.CONNECTIONS){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Me(o.rowIndex),2===e.button&&Pe()}},mouseup:()=>ae(),mouseleave:()=>ae(),contextmenu:e=>e.preventDefault()}}))},onremove:xe,onswap:ye}),j=new l({onadd:(e,t,n)=>{var o,i;n&&be(),e.appendChild(f("button",{text:null!==(i=null===(o=ne)||void 0===o?void 0:o.icons[t].icon)&&void 0!==i?i:"arrow_up",events:{mousedown(e){var t,n;if(ie===ee.RESULT){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Me(o.rowIndex),2===e.button&&Pe()}},mouseup:()=>ae(),mouseleave:()=>ae(),contextmenu:e=>e.preventDefault()}}))},onremove:Se,onswap:Te}),Y=new l({onadd:(e,t,n)=>{var o,i;n&&_e(),e.appendChild(f("button",{text:null!==(i=null===(o=ne)||void 0===o?void 0:o.landmarks[t].id)&&void 0!==i?i:"",events:{mousedown(e){var t,n;if(ie===ee.RESULT){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Me(~o.rowIndex-1),2===e.button&&Pe()}},mouseup:()=>ae(),mouseleave:()=>ae(),contextmenu:e=>e.preventDefault()}}))},onremove:Ie,onswap:Ce});var $=(new r).attachElement(f("div",{append:[f("span",{text:y("inspector.floor.level")+" "}),A.level,f("p",{text:y("inspector.floor.level.note")})]})).attachElement(f("div",{append:[f("h2",{text:y("inspector.floor.handle")}),f("span",{text:y("inspector.floor.handle.note")}),A.container,A.button]})).attachElement(f("div",{append:[f("h2",{text:y("inspector.floor.maps")}),z.getTable(),z.button]})).attachElement(f("div",{append:[f("h2",{text:y("inspector.floor.connections")}),D.getTable(),D.button]})).attachElement(f("div",{append:[f("h2",{text:y("inspector.floor.icons")}),j.getTable(),j.button]})).attachElement(f("div",{append:[f("h2",{text:y("inspector.floor.landmarks")}),Y.getTable(),Y.button]})).attachElement(f("div",{append:[f("span",{text:y("inspector.floor.selected")+": "}),A.selected]}));var X=new r;function J(e,t){const n=document.createElement("span");return n.innerText=e,n.onclick=t,n}function K(e){var t;for(let n=0;n<W.length;n++)null===(t=W[n])||void 0===t||t.setDisplay(n===e),n===e&&(H.title.innerText=y("inspector."+V[n]))}const H=Object.assign(Object.assign(Object.assign(Object.assign({title:f("h1")},U),R),A),{}),W=[L,O,$,X],V=["transfer","area","floor","selection"];K(0);var Z=f("div",{classes:["ui"],append:[f("h1",{text:y("inspector")}),f("div",{classes:["separator"],append:[J(y("inspector.tabs.transfer"),()=>{K(0)}),J(y("inspector.tabs.area"),()=>{K(1)}),J(y("inspector.tabs.floor"),()=>{K(2)}),J(y("inspector.tabs.selection"),()=>{K(3)})]}),H.title,W[0].getElement(),W[1].getElement(),W[2].getElement(),W[3].getElement()],events:{wheel:e=>e.stopPropagation(),keydown:e=>e.stopPropagation()}});class G{constructor(e){var t,n,o,i,s;if(this.width=null!==(t=null==e?void 0:e.width)&&void 0!==t?t:1,this.height=null!==(n=null==e?void 0:e.height)&&void 0!==n?n:1,this.floors=[],(null===(o=null==e?void 0:e.floors)||void 0===o?void 0:o.length)>0)for(const t of null==e?void 0:e.floors)this.floors.push(b.from(t));else this.addFloor();this.defaultFloor=null==e?void 0:e.defaultFloor,H.width.value=this.width.toString(),H.height.value=this.height.toString(),H.defaultFloor.value=null!==(s=null===(i=this.defaultFloor)||void 0===i?void 0:i.toString())&&void 0!==s?s:""}getFloorByIndex(e){if(e<0||e>=this.floors.length)throw`A floor by the index ${e} was attempted to be fetched but no floor by that index exists!`;return this.floors[e]}getFloorByLevel(e){for(const t of this.floors)if(e===t.level)return t}getIndexByLevel(e){for(let t=0;t<this.floors.length;t++)if(e===this.floors[t].level)return t;return-1}resize(e,t,n=0,o=0){if(e<0||t<0)throw new RangeError("You cannot resize the area to be less than 0 in width or height!");for(const i of this.floors)i.resize(e,t,n,o);this.width=e,this.height=t,H.width.value=e.toString(),H.height.value=t.toString()}addFloor(e){let t=0;if(this.floors.length>0){const n=null!=e?e:this.floors.length;t=n>=this.floors.length?this.floors[n-1].level+1:this.floors[n].level-1}d(this.floors,new b(t,this.width,this.height),e)}moveFloor(e,t){c(this.floors,e,t)}swapFloors(e,t){h(this.floors,e,t)}removeFloor(e){u(this.floors,e)}getWidth(){return this.width}getHeight(){return this.height}getAmountOfFloors(){return this.floors.length}}let q=null;function Q(e){q=e,le()}var ee;!function(e){e[e.TILES=0]="TILES",e[e.CONNECTIONS=1]="CONNECTIONS",e[e.RESULT=2]="RESULT"}(ee||(ee={}));const te=Object.keys(ee).length/2;let ne,oe=0,ie=ee.TILES,se=0;function ae(e,t){ne&&(ie===ee.TILES?ne.render(!1,{isolate:e,select:t}):ie===ee.CONNECTIONS?ne.render(!0,{debugConnectionsMode:!0,isolate:e,select:t}):ie===ee.RESULT&&ne.render(!0,{isolate:e,select:t}))}function re(e,t){Q(new G({width:e,height:t})),le()}function le(){var e,t;if(q){oe=null!==(t=q.getIndexByLevel(null!==(e=q.defaultFloor)&&void 0!==e?e:0))&&void 0!==t?t:0,ne=q.getFloorByIndex(oe),he(oe),st.bind(),N.clearRows();for(let e=q.getAmountOfFloors();e--;)N.addRow();Be()}else console.warn("Tried to load an area without first initializing it!")}function de(){st.generateNewPalette(),ae()}function ce(e){he(oe+e)}function he(e=oe){if(q&&ne&&e>=0&&e<q.getAmountOfFloors()){ne=q.getFloorByIndex(e),oe=e,H.level.value=ne.level.toString(),ae(),ne.handle?M(ne.handle):B(),z.clearRows(),D.clearRows(),j.clearRows(),Y.clearRows();for(let e=0;e<ne.maps.length;e++)z.addRow();for(let e=0;e<ne.connections.length;e++)D.addRow();for(let e=0;e<ne.icons.length;e++)j.addRow();for(let e=0;e<ne.landmarks.length;e++)Y.addRow()}}function ue(){q&&ne&&(q.addFloor(),he())}function fe(e){q&&ne&&(q.removeFloor(e),0===q.getAmountOfFloors()?(q.addFloor(),H.level.value=ne.level.toString(),N.addRow()):oe===q.getAmountOfFloors()&&oe--,he())}function pe(e,t){q&&ne&&(q.swapFloors(e,t),he())}function ge(){null==ne||ne.addMap("",x.untitled)}function ve(e){null==ne||ne.removeMap(e),ae()}function me(e,t){null==ne||ne.swapMaps(e,t)}function we(){null==ne||ne.addConnection(0,0,0,0,1,!1)}function xe(e){null==ne||ne.removeConnection(e),ae()}function ye(e,t){null==ne||ne.swapConnections(e,t)}function be(){null==ne||ne.addIcon("arrow_up",0,0,0)}function Se(e){null==ne||ne.removeIcon(e),ae()}function Te(e,t){null==ne||ne.swapIcons(e,t)}function _e(){null==ne||ne.addLandmark("landmark",0,0,0)}function Ie(e){null==ne||ne.removeLandmark(e),ae()}function Ce(e,t){null==ne||ne.swapLandmarks(e,t)}function Ee(e,t){ne&&ie===ee.TILES&&(ne.setTile(e,t,se),st.setTile(e,t,se))}function Ue(e,t,n,o){if(ne&&ie===ee.TILES){if(n<e){const t=e;e=n,n=t}if(o<t){const e=t;t=o,o=e}for(let i=t;i<=o;i++)for(let t=e;t<=n;t++)ne.setTile(t,i,se);ae()}}function ke(e,t,n,o){if(ne&&ie===ee.TILES){if(ae(),n<e){const t=e;e=n,n=t}if(o<t){const e=t;t=o,o=e}for(let i=t;i<=o;i++)for(let t=e;t<=n;t++)st.setTile(t,i,se)}}function Le(e){var t,n;q?q.resize(null!==(t=e.width)&&void 0!==t?t:q.getWidth(),null!==(n=e.height)&&void 0!==n?n:q.getHeight(),e.offsetX,e.offsetY):Q(new G({width:e.width,height:e.height})),ae()}function Re(e,t){if(ne&&ie===ee.CONNECTIONS){const n=ne.getConnectionByIndex(se);n&&(n.tx=e,n.ty=t,ae())}}function Ne(){if(ne&&ie===ee.CONNECTIONS){const e=ne.getConnectionByIndex(se);if(e){const t="VERTICAL"===e.dir;e.dir=t?"HORIZONTAL":"VERTICAL",ae()}}}function Oe(e,t){if(ne&&ie===ee.CONNECTIONS){const n=ne.getConnectionByIndex(se);if(n){const o="VERTICAL"===n.dir,i=Math.max(e-n.tx+1,1),s=Math.max(t-n.ty+1,1);n.size=o?i:s,console.log(o,i,s),ae()}}}function Fe(e,t){if(ne&&ie===ee.RESULT){const n=se<-1?ne.getLandmarkByIndex(~se-1):ne.getIconByIndex(se);n&&(n.x=e,n.y=t,ae())}}function Ae(e,t,n){if((!n||ie===n)&&ne){const n=Math.floor(e/8),o=Math.floor(t/8);ie===ee.TILES?se=ne.getMapIndexByPosition(n,o):ie===ee.CONNECTIONS?se=ne.getConnectionIndexByPosition(n,o):ie===ee.RESULT&&(se=ne.getIconIndexByPosition(e,t)),Be()}}function Me(e){se=e,Be()}function Be(){ie===ee.TILES?H.selected.innerText=(se-1).toString():H.selected.innerText=-1===se?"N/A":(se<0?~se-1:se).toString()}function Pe(){if(ne)if(ie===ee.TILES)ae([se],se);else if(ie===ee.CONNECTIONS){const e=ne.getConnectionByIndex(se);e&&ae([e.map1+1,e.map2+1],se)}else if(ie===ee.RESULT){const e=se<-1?ne.getLandmarkByIndex(~se-1):ne.getIconByIndex(se);e&&ae([e.map+1],se)}}function ze(e,t){st.movePosition(e,t)}function De(){st.resetPosition(),st.setZoom(1)}function je(e){"number"==typeof e&&e in ee?ie=e:(ie++,ie>=te&&(ie=0)),se=ie===ee.TILES?0:-1,Be(),ae()}function Ye(e){st.changeZoom(e)}let $e=!1,Xe=!1,Je=!1,Ke=0,He=0,We=0,Ve=0,Ze=!1;const Ge={Minus:()=>Ye(-1),Equal:()=>Ye(1),KeyQ:()=>ce(-1),KeyE:()=>ce(1),ArrowUp:e=>ze(0,e?-100:-50),ArrowDown:e=>ze(0,e?100:50),ArrowLeft:e=>ze(e?-100:-50,0),ArrowRight:e=>ze(e?100:50,0),KeyR:()=>De(),Digit1:()=>je(ee.TILES),Digit2:()=>je(ee.CONNECTIONS),Digit3:()=>je(ee.RESULT)};function qe(e){const t=e.offsetX,n=e.offsetY,o=Math.floor(t/8),i=Math.floor(n/8),s=e.shiftKey;0===e.button?(Ae(t,n,ee.CONNECTIONS),Ae(t,n,ee.RESULT),s?(Ke=o,He=i,We=o,Ve=i,ke(o,i,o,i)):Ee(o,i),$e=!0,Ze=!1):1===e.button?(e.preventDefault(),e.stopImmediatePropagation(),tt.start(t,n),Je=!0):2===e.button&&(nt.start(t,n),Xe=!0)}function Qe(e){const t=e.offsetX,n=e.offsetY,o=Math.floor(t/8),i=Math.floor(n/8),s=e.shiftKey;$e&&(o!==We&&i!==Ve&&(s?(We=o,Ve=i,ke(Ke,He,o,i),Oe(o,i)):(Ee(o,i),Re(o,i),Fe(t,n))),Ze=!0),Je&&tt.move(t,n),Xe&&nt.move(t,n)}function et(e){const t=e.offsetX,n=e.offsetY,o=Math.floor(t/8),i=Math.floor(n/8),s=e.shiftKey;$e&&(s&&Ue(Ke,He,o,i),Ze||Ne()),Je&&tt.stop(t,n),Xe&&nt.stop(t,n),$e=!1,Je=!1,Xe=!1}const tt={lastX:0,lastY:0,start(e,t){this.lastX=e,this.lastY=t},move(e,t){const n=e-this.lastX,o=t-this.lastY;ze(n,o),this.lastX=e-n,this.lastY=t-o},stop(e,t){}},nt={start(e,t){Ae(e,t),Pe()},move(e,t){},stop(e,t){ae()}},ot=new Image;ot.src="tiles.png";const it=new Image;it.src="icons.png";var st=new class{constructor(){this.container=document.createElement("div"),this.container.classList.add("center"),this.background=document.createElement("canvas"),this.foreground=document.createElement("canvas"),this.container.appendChild(this.background),this.container.appendChild(this.foreground),this.contextBG=this.background.getContext("2d"),this.contextFG=this.foreground.getContext("2d"),this.context=this.contextBG,this.width=8,this.height=8,this.offsetX=0,this.offsetY=0,this.factor=1,this.pushTransform(),this.generateTiles(s.from([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),[1]),this.resetPosition()}setTile(e,t,n,o=!1){this.context&&!this.isOutOfBounds(e,t)&&(this.context.fillStyle=o?"#"+n.toString(16).padStart(6,"0"):i.getColor(n),this.context.fillRect(8*e,8*t,8,8))}drawTile(e,t,n){if(this.context&&!this.isOutOfBounds(e,t))for(const o of n)this.context.drawImage(ot,o[0]||0,o[1]||0,o[2]||8,o[3]||8,8*e+(o[4]||0),8*t+(o[5]||0),o[2]||8,o[3]||8)}drawIcon(e,t,n){var o;if(!(n in rt))throw`"${n}" is not a valid icon name!`;if(this.context&&!this.isOutOfBounds(e/8,t/8)){const i=rt[n];null===(o=this.context)||void 0===o||o.drawImage(it,i[0]||0,i[1]||0,i[2]||12,i[3]||12,e+(i[4]||-6),t+(i[5]||-6),i[2]||12,i[3]||12)}}setRenderingMode(e){this.context=e?this.contextFG:this.contextBG}isOutOfBounds(e,t){return e<0||e>=this.width/8||t<0||t>=this.height/8}setSize(e,t){this.width=8*e,this.height=8*t,this.background.width=this.width,this.background.height=this.height,this.foreground.width=this.width,this.foreground.height=this.height,this.container.style.width=this.width+"px",this.container.style.height=this.height+"px"}movePosition(e,t){this.factor>=1&&(this.offsetX+=e,this.offsetY+=t,this.pushTransform())}resetPosition(){this.offsetX=0,this.offsetY=0,this.pushTransform()}setZoom(e){if(e%1!=0)throw`Renderer.setZoom(${e}) was called with a non-integer number!`;this.factor=e,this.pushTransform()}changeZoom(e){if(e%1!=0)throw`Renderer.changeZoom(${e}) was called with a non-integer number!`;this.factor+=e,this.factor<1&&(this.factor=1),this.pushTransform()}pushTransform(){let e=this.factor;e<=0&&(e=Math.abs(1/(e-2))),this.container.style.transform=`translate(-50%, -50%) translate(${this.offsetX}px, ${this.offsetY}px) scale(${e})`}generateTiles(e,t){this.setSize(e.getWidth(),e.getHeight()),e.iterate((e,n,o)=>{t?this.setTile(e,n,t.includes(o)?16777215:0,!0):this.setTile(e,n,o)})}generateTilesAdvanced(e,t){const n=e.getWidth(),o=e.getHeight();this.setSize(n,o);for(let i=0;i<o;i++)for(let s=0;s<n;s++){const a=e.get(s,i);if(void 0!==a)if(0===a||t&&!t.includes(a))this.drawTile(s,i,at.void);else{const t=0!==i&&e.get(s,i-1)===a,r=i!==o-1&&e.get(s,i+1)===a,l=0!==s&&e.get(s-1,i)===a,d=s!==n-1&&e.get(s+1,i)===a,c=0!==i&&0!==s&&e.get(s-1,i-1)!==a,h=0!==i&&s!==n-1&&e.get(s+1,i-1)!==a,u=i!==o-1&&0!==s&&e.get(s-1,i+1)!==a,f=i!==o-1&&s!==n-1&&e.get(s+1,i+1)!==a;this.drawTile(s,i,at.tiles[+t<<3|+r<<2|+l<<1|+d]),t&&l&&c&&this.drawTile(s,i,at.vertex.nw),t&&d&&h&&this.drawTile(s,i,at.vertex.ne),r&&l&&u&&this.drawTile(s,i,at.vertex.sw),r&&d&&f&&this.drawTile(s,i,at.vertex.se)}else console.warn(`Point (${s}, ${i}) was outside of the grid!`)}}drawConnection(e,t,n=!1,o=1){const i=n?"vertical":"horizontal";this.drawTile(e,t,at.connection[i].main);for(let s=1;s<Math.max(1,o);s++){let o=n?s:0,a=n?0:s,r=n?s-1:0,l=n?0:s-1;this.drawTile(e+o,t+a,at.connection[i].main),this.drawTile(e+r,t+l,at.connection[i].extend)}}drawDebugConnection(e,t,n=!1,o=1){if(this.setTile(e,t,16711680,!0),n){this.setTile(e,t+1,65280,!0);for(let n=1;n<o;n++)this.setTile(e+n,t,255,!0),this.setTile(e+n,t+1,255,!0)}else{this.setTile(e+1,t,65280,!0);for(let n=1;n<o;n++)this.setTile(e,t+n,255,!0),this.setTile(e+1,t+n,255,!0)}}getIconBounds(e,t,n){if(!(n in rt))throw`"${n}" is not a valid icon name!`;const o=rt[n],i=e+(o[4]||-6),s=t+(o[5]||-6);return[i,s,i+(o[2]||12),s+(o[3]||12)]}generateNewPalette(){i.generateNewPalette()}bind(){!function(e){e.onmousedown=qe,e.onmousemove=Qe,e.onmouseup=et,e.onmouseleave=et,window.onwheel=e=>{const t=e.shiftKey;e.deltaY<0?t?ce(1):Ye(1):e.deltaY>0&&(t?ce(-1):Ye(-1))},e.oncontextmenu=e=>e.preventDefault(),window.onkeydown=e=>{e.code in Ge&&Ge[e.code](e.shiftKey)}}(this.container)}attach(){document.body.appendChild(this.container)}};const at={void:[[0,0,8,8]],voidLarge:[[0,0,16,16]],tiles:[[[40,0]],[[16,0,8,4],[16,12,8,4,0,4]],[[24,0,8,4],[24,12,8,4,0,4]],[[20,0,8,4],[20,12,8,4,0,4]],[[16,0,4,8],[28,0,4,8,4,0]],[[16,0]],[[24,0]],[[20,0]],[[16,8,4,8],[28,8,4,8,4,0]],[[16,8]],[[24,8]],[[20,8]],[[16,4,4,8],[28,4,4,8,4,0]],[[16,4]],[[24,4]],[[20,4]]],vertex:{nw:[[32,0,4,4,0,0]],ne:[[36,0,4,4,4,0]],sw:[[32,4,4,4,0,4]],se:[[36,4,4,4,4,4]]},connection:{vertical:{main:[[40,8,8,2,0,6],[40,10,8,3,0,8]],extend:[[17,3,8,2,4,6],[17,3,8,3,4,8]]},horizontal:{main:[[32,8,3,8,5,0],[35,8,2,8,8,0]],extend:[[17,3,3,8,5,4],[17,3,2,8,8,4]]}}},rt={arrow_up:[0,0],arrow_down:[12,0],arrow_left:[24,0],arrow_right:[36,0],floor_down:[48,0],weapons:[60,0],quest:[72,0],entrance:[84,0],chest:[96,0],area_up:[0,12],area_down:[12,12],area_left:[24,12],area_right:[36,12],shop:[48,12],trader:[60,12],quest_hub:[72,12],landmark:[84,12,16,16,-7,-8]},lt=f("select",{events:{change(){ut(this.value)}},append:f("option")}),dt=f("div",{text:y("preferences.language.note")}),ct=f("input",{attributes:{type:"text",style:"width: 50px",placeholder:"en_US"}});for(const e of w)lt.appendChild(f("option",{text:e}));lt.value=p.language;var ht=f("div",{classes:["ui","sidebar"],append:[f("h1",{text:y("preferences")}),f("h2",{text:y("preferences.language")}),f("div",{append:[dt,f("div",{append:[lt,ct,f("button",{text:y("preferences.language.submit"),events:{click(){ut(ct.value),lt.value="",ct.value=""}}})]})]})]});function ut(e){const t=function(e,t,n=""){let o="",i=!1,s="";for(const a of e)"%"===a?(i&&(""===s?o+="%":(o+=s in t?t[s]:null==n?`%${s}%`:n,s="")),i=!i):i?s+=a:o+=a;return o}(y(p.set("language",e)?"preferences.language.success":"preferences.language.failure"),{language_name:m(e),language_tag:e});dt.innerText=t,setTimeout(()=>dt.innerText=y("preferences.language.note"),3e3)}st.attach(),document.body.appendChild(Z),document.body.appendChild(ht),document.body.ondrop=function(e){if(e.preventDefault(),e.dataTransfer)for(const t of e.dataTransfer.items){const e=t.getAsFile();if(e&&e.name.endsWith(".json")){C=e.name;const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=()=>{E(t.result)}}}},document.body.ondragover=e=>e.preventDefault(),Object.assign(window,{Renderer:st,Gateway:o,Settings:p})}]);