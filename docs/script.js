!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports=JSON.parse('{"supportedLanguages":["en_US"],"languages":{"en_US":"English","de_DE":"Deutsch","zh_CN":"简体中文","ja_JP":"日本語","ko_KR":"한국어","zh_TW":"繁體中文","ru_RU":"Русский","fr_FR":"Français"},"title":{"en_US":"CrossCode Area Editor","ko_KR":"크로스코드 지역 에디터"},"floor.upper":{"en_US":"F","de_DE":"E","zh_CN":"层","ja_JP":"階","ko_KR":"층","zh_TW":"層"},"floor.ground":{"en_US":"GF","de_DE":"EG","zh_CN":"基层","ja_JP":"地階","ko_KR":"지상","zh_TW":"基層"},"floor.lower":{"en_US":"U","de_DE":"U","zh_CN":"U","ja_JP":"地下","ko_KR":"U","zh_TW":"U"},"untitled":{"en_US":"untitled","de_DE":"unbetitelt","zh_CN":"未命名","ja_JP":"無題","ko_KR":"미정","zh_TW":"未命名"},"inspector":{"en_US":"Inspector","ko_KR":"인스펙터"},"inspector.select":{"en_US":"Select"},"inspector.tabs.transfer":{"en_US":"Transfer"},"inspector.tabs.area":{"en_US":"Area"},"inspector.tabs.floor":{"en_US":"Floor"},"inspector.tabs.selection":{"en_US":"Selection"},"inspector.transfer":{"en_US":"Transfer Data"},"inspector.transfer.note":{"en_US":"Here is where you can import existing data or export data from the editor for use in-game. To create a new area, go into the \\"Area\\" tab and set the area\'s dimensions there. Here, you can import an existing area by either copying and pasting the data or by uploading it. To export the area from the editor, you can either copy it from the text field or download it."},"inspector.transfer.textfield.paste":{"en_US":"Transferred into editor!"},"inspector.transfer.textfield.copy":{"en_US":"Copy"},"inspector.transfer.textfield.copy.status":{"en_US":"Copied to clipboard!"},"inspector.transfer.textfield.placeholder":{"en_US":"Paste JSON here."},"inspector.transfer.upload.note":{"en_US":"You can also drag and drop an area JSON file anywhere to load it into the editor."},"inspector.transfer.download":{"en_US":"Download"},"inspector.area":{"en_US":"Area Settings"},"inspector.area.dimensions":{"en_US":"Dimensions"},"inspector.area.width":{"en_US":"Width"},"inspector.area.height":{"en_US":"Height"},"inspector.area.offsetX":{"en_US":"Offset X"},"inspector.area.offsetY":{"en_US":"Offset Y"},"inspector.area.confirm":{"en_US":"Confirm"},"inspector.area.defaultFloor":{"en_US":"Default Floor"},"inspector.area.defaultFloor.note":{"en_US":"This setting determines the first floor you see when viewing this area from another area."},"inspector.area.floors":{"en_US":"Floors"},"inspector.area.palette":{"en_US":"Generate New Palette"},"inspector.area.note":{"en_US":"Note: Area metadata is stored in \\"assets/data/database.json/areas/<area>\\". This is where properties like the amount of chests in the area, names/descriptions, and its position on the global map are stored. The area data structure itself is for storing the grid and any other grid-specific data like maps, connections, icons, and landmarks."},"inspector.floor":{"en_US":"Floor Settings"},"inspector.floor.level":{"en_US":"Level"},"inspector.floor.level.note":{"en_US":"The level property only determines the display of this floor in the floor buttons. So you can have -2 then -4, which will show up in that order. A default floor property that doesn\'t match anything will just show a blank screen until you select a floor."},"inspector.floor.handle":{"en_US":"Custom Handler"},"inspector.floor.handle.note":{"en_US":"This will override the level property so instead of displaying \\"F5\\", you can instead display \\"F??\\" with this setting."},"inspector.floor.handle.add":{"en_US":"Add"},"inspector.floor.handle.remove":{"en_US":"Remove"},"inspector.floor.maps":{"en_US":"Maps"},"inspector.floor.connections":{"en_US":"Connections"},"inspector.floor.icons":{"en_US":"Icons"},"inspector.floor.landmarks":{"en_US":"Landmarks"},"inspector.floor.selected":{"en_US":"Selected Index"},"inspector.selection":{"en_US":"Nothing Selected"},"inspector.selection.none":{"en_US":"List of Controls"},"inspector.selection.map":{"en_US":"Map"},"inspector.selection.map.name":{"en_US":"Name"},"inspector.selection.map.path":{"en_US":"Path"},"inspector.selection.map.path.note":{"en_US":"The path requires a specific format to work properly. For example, \\"arid.town-1\\", which points to \\"assets/data/maps/arid/town-1.json\\"."},"inspector.selection.connection":{"en_US":"Connection"},"inspector.selection.connection.position":{"en_US":"Position"},"inspector.selection.connection.direction":{"en_US":"Direction"},"inspector.selection.connection.direction.horizontal":{"en_US":"Horizontal"},"inspector.selection.connection.direction.vertical":{"en_US":"Vertical"},"inspector.selection.connection.size":{"en_US":"Size"},"inspector.selection.connection.maps":{"en_US":"Bound Maps"},"inspector.selection.connection.condition":{"en_US":"Condition (optional)"},"inspector.selection.icon":{"en_US":"Icon"},"inspector.selection.icon.position":{"en_US":"Position"},"inspector.selection.icon.icon":{"en_US":"Icon"},"inspector.selection.icon.map":{"en_US":"Bound Map"},"inspector.selection.icon.data":{"en_US":"Icon Metadata"},"inspector.selection.icon.data.area":{"en_US":"Area"},"inspector.selection.icon.data.map":{"en_US":"Map"},"inspector.selection.icon.data.note":{"en_US":"This is required for area pointer icons. For the area field, put in the area identifier (like \\"arid-dng-2\\") and the map that it\'s pointing to (like \\"arid-dng.first.room-01\\")."},"inspector.selection.landmark":{"en_US":"Landmark"},"inspector.selection.landmark.position":{"en_US":"Position"},"inspector.selection.landmark.id":{"en_US":"ID"},"inspector.selection.landmark.map":{"en_US":"Bound Map"},"preferences":{"en_US":"Preferences"},"preferences.language":{"en_US":"Language"},"preferences.language.note":{"en_US":"This setting will be used to determine both the language that will appear in this program (if it\'s supported) as well as the default language that appears when you edit a map\'s name. Below, you\'ll see two fields: The first is a dropdown menu of all the fully-supported languages. The second is a text field where you can enter in any language code such as \\"en_US\\" in order to automatically switch to that language when editing map names. The two are intertwined."},"preferences.language.submit":{"en_US":"Submit"},"preferences.language.success":{"en_US":"Successfully set your language to %language_name% (%language_tag%)! Reload the page for these changes to take place."},"preferences.language.failure":{"en_US":"Failed to set your language to %language_name% (%language_tag%)! Your browser most likely doesn\'t support the local storage module."}}')},function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"VIEWS",(function(){return re})),n.d(o,"currentFloor",(function(){return ce})),n.d(o,"currentFloorIndex",(function(){return de})),n.d(o,"currentMode",(function(){return ue})),n.d(o,"selected",(function(){return he})),n.d(o,"currentTabOffset",(function(){return pe})),n.d(o,"render",(function(){return me})),n.d(o,"createArea",(function(){return ge})),n.d(o,"loadArea",(function(){return we})),n.d(o,"generateNewPalette",(function(){return xe})),n.d(o,"switchFloor",(function(){return be})),n.d(o,"setFloorView",(function(){return ye})),n.d(o,"addFloor",(function(){return Se})),n.d(o,"removeFloor",(function(){return Te})),n.d(o,"swapFloors",(function(){return Ie})),n.d(o,"addMap",(function(){return Ee})),n.d(o,"removeMap",(function(){return _e})),n.d(o,"swapMaps",(function(){return Ce})),n.d(o,"addConnection",(function(){return ke})),n.d(o,"removeConnection",(function(){return Ue})),n.d(o,"swapConnections",(function(){return Ne})),n.d(o,"addIcon",(function(){return Le})),n.d(o,"removeIcon",(function(){return Re})),n.d(o,"swapIcons",(function(){return Me})),n.d(o,"addLandmark",(function(){return Oe})),n.d(o,"removeLandmark",(function(){return Fe})),n.d(o,"swapLandmarks",(function(){return Ae})),n.d(o,"setTile",(function(){return De})),n.d(o,"setBox",(function(){return Be})),n.d(o,"setBoxPreview",(function(){return Pe})),n.d(o,"resizeArea",(function(){return ze})),n.d(o,"moveConnection",(function(){return Ye})),n.d(o,"rotateConnection",(function(){return Xe})),n.d(o,"resizeConnection",(function(){return je})),n.d(o,"moveIcon",(function(){return $e})),n.d(o,"setView",(function(){return He})),n.d(o,"select",(function(){return Ke})),n.d(o,"selectByIndex",(function(){return Ve})),n.d(o,"bind",(function(){return Ge})),n.d(o,"highlight",(function(){return Ze})),n.d(o,"panView",(function(){return qe})),n.d(o,"resetView",(function(){return Qe})),n.d(o,"switchZoom",(function(){return et}));var i=new class{constructor(){this.palette=[0]}getColor(e,t=!1){if(e<0)throw new RangeError(`Index out of bounds at getColor(${e})!`);e in this.palette||(this.palette[e]=Math.floor(16777216*Math.random()));const n=this.palette[e];return"#"+(t?function(e){if(e>16777215||e<0)throw new RangeError(`Color "${e}" provided to getInverse is not a valid RGB value!`);return 16777215&~e}(n):n).toString(16).padStart(6,"0")}generateNewPalette(){this.palette.splice(1)}};class a{constructor(e,t){this.width=e,this.height=t,this.data=new Uint8Array(e*t)}static from(e){var t;const n=e.length,o=e[0].length,i=new a(o,n);for(let a=0;a<n;a++){e[a].length!==o&&console.warn("This matrix does not have the same width throughout!",e);for(let n=0;n<o;n++)i.set(n,a,null!==(t=e[a][n])&&void 0!==t?t:0)}return i}get(e,t){if(!(e>=this.width||e<0||t>=this.height||t<0))return this.data[this.width*t+e]}set(e,t,n){if(e>=this.width||e<0||t>=this.height||t<0)throw new RangeError(`Index out of bounds! Called (${e}, ${t}) of width ${this.width} x height ${this.height}.`);this.data[this.width*t+e]=n}resize(e,t,n=0,o=0){const i=new Uint8Array(e*t);for(let a=0;a<this.data.length;a++){const s=a%this.width+n,r=Math.floor(a/this.width)+o;s>=0&&s<e&&r>=0&&r<t&&(i[e*r+s]=this.data[a])}this.data=i,this.width=e,this.height=t}iterate(e){for(let t=0;t<this.data.length;t++){const n=e(t%this.width,Math.floor(t/this.width),this.data[t]);"number"==typeof n&&(this.data[t]=n)}}getWidth(){return this.width}getHeight(){return this.height}toJSON(){const e=new Array(this.height);for(let t=0;t<this.height;t++)e[t]=Array.from(this.data.slice(this.width*t,this.width*(t+1)));return e}}class s{constructor(e){this.element=e}attach(e){return this.element.appendChild(e.element),this}attachElement(e){return this.element.appendChild(e),this}attachTo(e){e.appendChild(this.element)}}class r extends s{constructor(){super(document.createElement("div")),this.enabled=!0,this.setDisplay(!1)}setDisplay(e){const t=null!=e?e:!this.enabled;return this.enabled=t,this.element.style.display=t?"block":"none",this}getElement(){return this.element}}class l extends s{constructor(e,t=!1){var n,o,i;super(document.createElement("table")),this.tbody=document.createElement("tbody"),this.element.appendChild(this.tbody),this.button=p("button",{text:"+",events:{click:()=>this.addRow(!0)}}),this.onadd=null!==(n=null==e?void 0:e.onadd)&&void 0!==n?n:()=>{},this.onremove=null!==(o=null==e?void 0:e.onremove)&&void 0!==o?o:()=>{},this.onswap=null!==(i=null==e?void 0:e.onswap)&&void 0!==i?i:()=>{},this.tmpIndex=-1,t&&this.element.classList.add("reverse")}addRow(e=!1){const t=this,n=this.element.insertRow(),o=n.insertCell(),i=n.insertCell(),a=n.insertCell();o.classList.add("collapse"),o.appendChild(p("button",{text:"-",events:{click(){var e;const n=null===(e=this.parentElement)||void 0===e?void 0:e.parentElement;if(!n)throw"This event was called outside of a table!";const o=n.rowIndex;t.tbody.removeChild(n),t.onremove(o)}}})),i.classList.add("collapse"),i.appendChild(p("input",{attributes:{type:"checkbox"},events:{click(){var e;const n=null===(e=this.parentElement)||void 0===e?void 0:e.parentElement;if(!n)throw"This event was called outside of a table!";const o=n.rowIndex;if(-1===t.tmpIndex)t.tmpIndex=o;else{t.onswap(t.tmpIndex,o);const e=t.element.rows[t.tmpIndex];e.children[1].children[0].checked=!1,this.checked=!1,t.tmpIndex=-1;const i=p("span");n.after(i),e.after(n),i.after(e),t.tbody.removeChild(i)}}}}));const s=p("div");a.appendChild(s),this.onadd(s,n.rowIndex,e)}getRow(e){return this.element.rows[e]}clearRows(){for(let e=this.element.rows.length;e--;)this.element.deleteRow(0)}getTable(){return this.element}}function c(e,t,n){void 0!==n&&n<e.length?e.splice(n,0,t):e.push(t)}function d(e,t,n){e.splice(n,0,e.splice(t,1)[0])}function u(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function h(e,t){void 0!==t?e.splice(t,1):e.pop()}function p(e,t){const n=document.createElement(e);if((null==t?void 0:t.text)&&(n.innerText=t.text),null==t?void 0:t.classes)for(const e of t.classes)n.classList.add(e);if(null==t?void 0:t.attributes)for(const e in t.attributes)n.setAttribute(e,t.attributes[e]);if(null==t?void 0:t.events)for(const e in t.events)n.addEventListener(e,t.events[e]);if(null==t?void 0:t.append)if(Array.isArray(t.append))for(const e of t.append)n.appendChild(e);else n.appendChild(t.append);return n}var f=new class{constructor(){var e,t;let n;try{n=JSON.parse(null!==(e=window.localStorage.getItem("CCAE"))&&void 0!==e?e:"{}")}catch(e){n={}}this.language=null!==(t=n.language)&&void 0!==t?t:"en_US",this.save()}set(e,t){return e in this&&(this[e]=t,this.save(),!0)}save(){window.localStorage.setItem("CCAE",JSON.stringify(this))}},v=n(0);class m{constructor(e){if(this.languages={en_US:""},e)for(const t in e)"langUid"!==t&&(this.languages[t]=e[t])}get(e=f.language){var t;return e in this.languages?this.languages[e]:null!==(t=this.languages.en_US)&&void 0!==t?t:""}getClean(e=f.language){return g(this.get(e))}toJSON(){return this.languages}}function g(e){return/<<[AC]/g.test(e)&&(e=e.substring(0,e.search(/<<[AC]/g))),e}class w extends s{constructor(e){var t,n;super(document.createElement("div"));const o=this;this.input=p("input",{attributes:{type:"text",placeholder:null!==(t=null==e?void 0:e.placeholder)&&void 0!==t?t:""},events:{input(){var t;o.langlabel.languages[o.tag]=this.value,null===(t=null==e?void 0:e.callback)||void 0===t||t.call(e,this.value,o.tag)}}}),this.menu=p("select",{events:{change(){var e;o.tag=this.value,o.input.value=null!==(e=o.langlabel.get(o.tag))&&void 0!==e?e:""}}}),this.langlabel=null!==(n=null==e?void 0:e.langlabel)&&void 0!==n?n:new m,this.tag=f.language,this.element.appendChild(this.input),this.element.appendChild(this.menu),this.createMenu()}setLangLabel(e){for(this.langlabel=e;this.menu.firstChild;)this.menu.removeChild(this.menu.firstChild);this.input.value="",this.createMenu()}createMenu(){let e=!1;for(const t in this.langlabel.languages){const n=p("option",{text:x(t),attributes:{value:t}});t===f.language&&(this.input.value=this.langlabel.get(t),n.selected=!0,e=!0),this.menu.appendChild(n)}if(!e){const e=f.language,t=p("option",{text:x(e),attributes:{value:e}});t.selected=!0,this.menu.appendChild(t)}}getElement(){return this.element}}function x(e){return e in v.languages?y.languages.get(e):e}const b=v.supportedLanguages;delete v.supportedLanguages;const y={};for(const e in v)y[e]=new m(v[e]);function S(e,t){const n=y[e];return n?n.get(t):"N/A"}document.title=S("title");class T{constructor(e,t,n){if(this.level=e,t.constructor===a)this.tiles=t;else{if(t.constructor!==Number||!n)throw`Invalid constructor call to Floor! new Floor(${e}, ${t}, ${n})`;this.tiles=new a(t,n)}this.icons=[],this.maps=[],this.connections=[],this.landmarks=[]}static from(e){const t=new T(e.level,a.from(e.tiles));e.handle&&(t.handle=new m(e.handle));for(const n of e.maps)t.maps.push(new I(n));for(const n of e.connections)t.connections.push(new E(n));for(const n of e.icons)t.icons.push(new _(n));for(const n of e.landmarks)t.landmarks.push(new C(n));return t}setTile(e,t,n){if(n>this.maps.length)throw`Error: Attempted to place a tile with the value of ${n}, but the maximum allowed index is ${this.maps.length}! If you want to use more maps, you have to do so by calling Floor.addMap(...)!`;this.tiles.set(e,t,n)}getFloorName(){return this.handle?this.handle.getClean():0===this.level?S("floor.ground"):this.level>0?Math.abs(this.level)+S("floor.upper"):this.level<0?S("floor.lower")+Math.abs(this.level):"N/A"}render(e,t){if(gt.setRenderingMode(!1),e)if(gt.generateTilesAdvanced(this.tiles,null==t?void 0:t.isolate),gt.setRenderingMode(!0),null==t?void 0:t.debugConnectionsMode)for(let e=0;e<this.connections.length;e++){const n=this.connections[e];void 0!==t.select&&e!==t.select||gt.drawDebugConnection(n.tx,n.ty,"VERTICAL"===n.dir,n.size)}else if(null==t?void 0:t.isolate){for(let e=0;e<this.icons.length;e++){const n=this.icons[e];!t.isolate.includes(n.map+1)||void 0!==t.select&&e!==t.select||gt.drawIcon(n.x,n.y,n.icon)}for(let e=0;e<this.landmarks.length;e++){const n=this.landmarks[e];t.isolate.includes(n.map+1)&&gt.drawIcon(n.x,n.y,"landmark")}}else{for(const e of this.connections)gt.drawConnection(e.tx,e.ty,"VERTICAL"===e.dir,e.size);for(const e of this.icons)gt.drawIcon(e.x,e.y,e.icon);for(const e of this.landmarks)gt.drawIcon(e.x,e.y,"landmark")}else gt.generateTiles(this.tiles,null==t?void 0:t.isolate);gt.setRenderingMode(!0)}resize(e,t,n=0,o=0){if(this.tiles.resize(e,t,n,o),0!==n||0!==o){const e=[],t=[],i=[];for(let t=0;t<this.connections.length;t++){const i=this.connections[t];i.tx+=n,i.ty+=o,(i.tx<0||i.ty<0)&&e.push(t)}for(let e=0;e<this.icons.length;e++){const i=this.icons[e];i.x+=8*n,i.y+=8*o,(i.x<0||i.y<0)&&t.push(e)}for(let e=0;e<this.landmarks.length;e++){const t=this.landmarks[e];t.x+=8*n,t.y+=8*o,(t.x<0||t.y<0)&&i.push(e)}for(const t of e)this.removeConnection(t);for(const e of t)this.removeIcon(e);for(const e of i)this.removeLandmark(e)}}addMap(e,t,n){c(this.maps,new I({path:e,name:t}),n)}moveMap(e,t){d(this.maps,e,t)}swapMaps(e,t){u(this.maps,e,t);const n=e+1,o=t+1;this.tiles.iterate((e,t,i)=>n===i?o:o===i?n:i)}removeMap(e){h(this.maps,e);const t=(null!=e?e:this.maps.length-1)+1;this.tiles.iterate((e,n,o)=>o===t?0:o>t?o-1:o);for(const e of this.connections)e.map1--,e.map2--;for(const e of this.icons)e.map--;for(const e of this.landmarks)e.map--}addConnection(e,t,n,o,i,a,s){c(this.connections,new E({tx:e,ty:t,dir:a?"VERTICAL":"HORIZONTAL",size:i,map1:n,map2:o}),s)}moveConnection(e,t){d(this.connections,e,t)}swapConnections(e,t){u(this.connections,e,t)}removeConnection(e){h(this.connections,e)}addIcon(e,t,n,o,i){c(this.icons,new _({icon:e,x:t,y:n,map:o}),i)}moveIcon(e,t){d(this.icons,e,t)}swapIcons(e,t){u(this.icons,e,t)}removeIcon(e){h(this.icons,e)}addLandmark(e,t,n,o,i){c(this.landmarks,new C({id:e,x:t,y:n,map:o}),i)}moveLandmark(e,t){d(this.landmarks,e,t)}swapLandmarks(e,t){u(this.landmarks,e,t)}removeLandmark(e){h(this.landmarks,e)}getMapIndexByPosition(e,t){var n;return null!==(n=this.tiles.get(e,t))&&void 0!==n?n:-1}getConnectionIndexByPosition(e,t){for(let n=0;n<this.connections.length;n++){const o=this.connections[n],i="VERTICAL"===o.dir,a=o.tx,s=o.ty,r=i?a+o.size-1:a+1,l=i?s+1:s+o.size-1;if(e>=a&&e<=r&&t>=s&&t<=l)return n}return-1}getIconIndexByPosition(e,t){for(let n=0;n<this.icons.length;n++){const o=this.icons[n],[i,a,s,r]=gt.getIconBounds(o.x,o.y,o.icon);if(e>=i&&e<=s&&t>=a&&t<=r)return n}for(let n=0;n<this.landmarks.length;n++){const o=this.landmarks[n],[i,a,s,r]=gt.getIconBounds(o.x,o.y,"landmark");if(e>=i&&e<=s&&t>=a&&t<=r)return~n-1}return-1}getMapByIndex(e){return this.maps[e]}getConnectionByIndex(e){return this.connections[e]}getIconByIndex(e){return this.icons[e]}getLandmarkByIndex(e){return this.landmarks[e]}}class I{constructor(e){var t;this.path=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"",this.name=new m(null==e?void 0:e.name)}}class E{constructor(e){var t,n,o,i,a;this.tx=null!==(t=null==e?void 0:e.tx)&&void 0!==t?t:0,this.ty=null!==(n=null==e?void 0:e.ty)&&void 0!==n?n:0,this.dir=["HORIZONTAL","VERTICAL"].includes(null==e?void 0:e.dir)?null==e?void 0:e.dir:"HORIZONTAL",this.size=null!==(o=null==e?void 0:e.size)&&void 0!==o?o:1,this.map1=null!==(i=null==e?void 0:e.map1)&&void 0!==i?i:0,this.map2=null!==(a=null==e?void 0:e.map2)&&void 0!==a?a:0,this.condition=null==e?void 0:e.condition,this.offset=null==e?void 0:e.offset}}class _{constructor(e){var t,n,o,i;this.icon=null!==(t=null==e?void 0:e.icon)&&void 0!==t?t:"chest",this.x=null!==(n=null==e?void 0:e.x)&&void 0!==n?n:0,this.y=null!==(o=null==e?void 0:e.y)&&void 0!==o?o:0,this.map=null!==(i=null==e?void 0:e.map)&&void 0!==i?i:0,this.data=null==e?void 0:e.data}}class C{constructor(e){var t,n,o,i;this.id=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"",this.x=null!==(n=null==e?void 0:e.x)&&void 0!==n?n:0,this.y=null!==(o=null==e?void 0:e.y)&&void 0!==o?o:0,this.map=null!==(i=null==e?void 0:e.map)&&void 0!==i?i:0}}let k="area.json";function U(e){try{se(new ie(JSON.parse(e)))}catch(e){se(new ie)}}const N={textfield:p("input",{attributes:{type:"text",placeholder:S("inspector.transfer.textfield.placeholder")},events:{input:function(){U(this.value),this.blur(),this.value="",this.placeholder=S("inspector.transfer.textfield.paste"),setTimeout(()=>this.placeholder=S("inspector.transfer.textfield.placeholder"),1500)}}})};var L,R=(new r).attachElement(p("div",{text:S("inspector.transfer.note")})).attachElement(p("div",{append:[N.textfield,p("button",{text:S("inspector.transfer.textfield.copy"),events:{click:(L=N.textfield,function(){ae&&(L.value=JSON.stringify(ae),L.select(),L.setSelectionRange(0,99999),document.execCommand("copy"),L.blur(),L.value="",L.placeholder=S("inspector.transfer.textfield.copy.status"),setTimeout(()=>L.placeholder=S("inspector.transfer.textfield.placeholder"),1500))})}})]})).attachElement(p("div",{append:[p("input",{attributes:{type:"file"},events:{change:function(){var e;const t=null===(e=this.files)||void 0===e?void 0:e[0];if(null==t?void 0:t.name.endsWith(".json")){const e=new FileReader;k=t.name,e.readAsText(t,"UTF-8"),e.onload=()=>{U(e.result)}}}}}),p("p",{text:S("inspector.transfer.upload.note")})]})).attachElement(p("div",{append:p("button",{text:S("inspector.transfer.download"),events:{click:function(){if(ae){const e=document.createElement("a");e.download=k,e.href=window.URL.createObjectURL(new Blob([JSON.stringify(ae)],{type:"text/plain"})),e.click(),e.remove()}}}})})).setDisplay();const M={width:p("input",{attributes:{type:"number",value:"1"}}),height:p("input",{attributes:{type:"number",value:"1"}}),offsetX:p("input",{attributes:{type:"number"}}),offsetY:p("input",{attributes:{type:"number"}}),defaultFloor:p("input",{attributes:{type:"number"},events:{input(){ae?ae.defaultFloor=parseInt(this.value):this.value=""}}})},O=new l({onadd:(e,t,n)=>{var o;n&&Se(),e.appendChild(p("button",{text:(null!==(o=null==ae?void 0:ae.getFloorByIndex(t).getFloorName())&&void 0!==o?o:"N/A")+" ",events:{click(){var e,t;const n=null===(t=null===(e=null==this?void 0:this.parentElement)||void 0===e?void 0:e.parentElement)||void 0===t?void 0:t.parentElement;if(!n)throw"This event was called outside of a table!";ye(n.rowIndex)}}}))},onremove:Te,onswap:Ie},!0);var F=(new r).attachElement(p("div",{append:[p("h2",{text:S("inspector.area.dimensions")}),p("span",{text:S("inspector.area.width")+" "}),M.width,p("span",{text:" "+S("inspector.area.height")+" "}),M.height,p("br"),p("span",{text:S("inspector.area.offsetX")+" "}),M.offsetX,p("span",{text:" "+S("inspector.area.offsetY")+" "}),M.offsetY,p("br"),p("button",{text:S("inspector.area.confirm"),events:{click(){ze({width:parseInt(M.width.value)||void 0,height:parseInt(M.height.value)||void 0,offsetX:parseInt(M.offsetX.value)||void 0,offsetY:parseInt(M.offsetY.value)||void 0}),M.offsetX.value="",M.offsetY.value=""}}})]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.area.defaultFloor")}),M.defaultFloor,p("p",{text:S("inspector.area.defaultFloor.note")})]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.area.floors")}),O.getTable(),O.button]})).attachElement(p("div",{append:p("button",{text:S("inspector.area.palette"),events:{click:xe}})})).attachElement(p("div",{append:p("p",{text:S("inspector.area.note")})}));const A=new w({callback:H}),D=new l({onadd:(e,t,n)=>{var o;n&&Ee(),e.appendChild(p("button",{text:(null===(o=ce)||void 0===o?void 0:o.maps[t].name.getClean())||S("untitled"),events:{mousedown(e){var t,n;if(ue===re.TILES){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Ve(o.rowIndex+1),2===e.button&&Ze()}},mouseup:()=>me(),mouseleave:()=>me(),contextmenu:e=>e.preventDefault()}}))},onremove:_e,onswap:Ce}),B=new l({onadd:(e,t,n)=>{var o,i,a;n&&ke();const s=null===(o=ce)||void 0===o?void 0:o.connections[t];e.appendChild(p("button",{text:`(${null!==(i=null==s?void 0:s.tx)&&void 0!==i?i:0}, ${null!==(a=null==s?void 0:s.ty)&&void 0!==a?a:0})`,events:{mousedown(e){var t,n;if(ue===re.CONNECTIONS){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Ve(o.rowIndex),2===e.button&&Ze()}},mouseup:()=>me(),mouseleave:()=>me(),contextmenu:e=>e.preventDefault()}}))},onremove:Ue,onswap:Ne}),P=new l({onadd:(e,t,n)=>{var o,i;n&&Le(),e.appendChild(p("button",{text:null!==(i=null===(o=ce)||void 0===o?void 0:o.icons[t].icon)&&void 0!==i?i:"arrow_up",events:{mousedown(e){var t,n;if(ue===re.RESULT){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Ve(o.rowIndex),2===e.button&&Ze()}},mouseup:()=>me(),mouseleave:()=>me(),contextmenu:e=>e.preventDefault()}}))},onremove:Re,onswap:Me}),z=new l({onadd:(e,t,n)=>{var o,i;n&&Oe(),e.appendChild(p("button",{text:null!==(i=null===(o=ce)||void 0===o?void 0:o.landmarks[t].id)&&void 0!==i?i:"",events:{mousedown(e){var t,n;if(ue===re.RESULT){const o=null===(n=null===(t=null==this?void 0:this.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;if(!o)throw"This event was called outside of a table!";Ve(~o.rowIndex-1),2===e.button&&Ze()}},mouseup:()=>me(),mouseleave:()=>me(),contextmenu:e=>e.preventDefault()}}))},onremove:Fe,onswap:Ae}),Y=[(new r).attachElement(p("h2",{text:S("inspector.floor.maps")})).attachElement(D.getTable()).attachElement(D.button),(new r).attachElement(p("h2",{text:S("inspector.floor.connections")})).attachElement(B.getTable()).attachElement(B.button),(new r).attachElement(p("h2",{text:S("inspector.floor.icons")})).attachElement(P.getTable()).attachElement(P.button),(new r).attachElement(p("h2",{text:S("inspector.floor.landmarks")})).attachElement(z.getTable()).attachElement(z.button)],X={level:p("input",{attributes:{type:"number"},events:{input(){ce&&ae?(ce.level=parseInt(this.value),H()):this.value=""}}}),button:p("button",{text:S("inspector.floor.handle.add"),events:{click(){if(ce){let e=ce.handle;e?(ce.handle=void 0,$()):(e=new m,ce.handle=e,j(e)),H()}}}}),container:A.getElement()};function j(e){A.setLangLabel(e),X.container.style.display="block",X.button.innerText=S("inspector.floor.handle.remove")}function $(){X.container.style.display="none",X.button.innerText=S("inspector.floor.handle.add")}function H(){var e,t;if(!ce)throw"setFloorHeader was called in the wrong context!";const n=O.getRow(de),o=null===(t=null===(e=null==n?void 0:n.children[2])||void 0===e?void 0:e.children[0])||void 0===t?void 0:t.children[0];if(!o)throw"Invalid span type assertion at inspector.elements.level.events.input!";o.innerText=ce.getFloorName()+" "}$();var J=(new r).attachElement(p("div",{append:[p("h2",{text:S("inspector.floor.level")}),X.level,p("p",{text:S("inspector.floor.level.note")})]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.floor.handle")}),p("p",{text:S("inspector.floor.handle.note")}),X.container,X.button]})).attach(Y[0]).attach(Y[1]).attach(Y[2]).attach(Y[3]);const K=new w({callback(e,t){const n=he-1;if(t===f.language){const t=D.getRow(n).children[2].children[0].children[0];if(!t)throw"No button element is defined at mapName.callback!";t.innerText=g(e)}}}),V={mapName:K.getElement(),mapPath:p("input",{attributes:{type:"text"},events:{input(){if(ue!==re.TILES)throw"inspector.mapPath was edited without the tile editor being active!";ce&&(ce.maps[he-1].path=this.value)}}}),connectionX:p("input",{attributes:{type:"number"},events:{input(){Ye(parseInt(this.value),parseInt(V.connectionY.value),!0)}}}),connectionY:p("input",{attributes:{type:"number"},events:{input(){Ye(parseInt(V.connectionX.value),parseInt(this.value),!0)}}}),connectionDirection:p("select",{append:[p("option",{text:S("inspector.selection.connection.direction.horizontal"),attributes:{value:"HORIZONTAL"}}),p("option",{text:S("inspector.selection.connection.direction.vertical"),attributes:{value:"VERTICAL"}})],events:{input:()=>Xe(!0)}}),connectionSize:p("input",{attributes:{type:"number"},events:{input(){const e=parseInt(this.value)-1;e<0&&(this.value="1"),je(parseInt(V.connectionX.value)+e,parseInt(V.connectionY.value)+e,!0)}}}),connectionMap1:p("input",{attributes:{type:"number"},events:{input(){ce&&(ce.connections[he].map1=parseInt(this.value))}}}),connectionMap2:p("input",{attributes:{type:"number"},events:{input(){ce&&(ce.connections[he].map2=parseInt(this.value))}}}),connectionCondition:p("input",{attributes:{type:"text"},events:{input(){if(ce){const e=""!==this.value?this.value:void 0;ce.connections[he].condition=e}}}}),iconX:p("input",{attributes:{type:"number"},events:{input(){ce&&(ce.icons[he].x=parseInt(this.value),me())}}}),iconY:p("input",{attributes:{type:"number"},events:{input(){ce&&(ce.icons[he].y=parseInt(this.value),me())}}}),iconType:p("select",{events:{input(){if(ce){ce.icons[he].icon=this.value,me();const e=P.getRow(he).children[2].children[0].children[0];if(!e)throw"No button element is defined at mapName.iconType!";e.innerText=this.value}}}}),iconMap:p("input",{attributes:{type:"number"},events:{input(){ce&&(ce.icons[he].map=parseInt(this.value))}}}),iconDataArea:p("input",{attributes:{type:"text"},events:{input(){if(ce){const e=ce.icons[he],t=this.value,n=V.iconDataMap.value;e.data=""===t&&""===n?void 0:{area:t,map:n}}}}}),iconDataMap:p("input",{attributes:{type:"text"},events:{input(){if(ce){const e=ce.icons[he],t=V.iconDataArea.value,n=this.value;e.data=""===t&&""===n?void 0:{area:t,map:n}}}}}),landmarkX:p("input",{attributes:{type:"number"},events:{input(){if(ce){const e=~he-1;ce.landmarks[e].x=parseInt(this.value),me()}}}}),landmarkY:p("input",{attributes:{type:"number"},events:{input(){if(ce){const e=~he-1;ce.landmarks[e].y=parseInt(this.value),me()}}}}),landmarkID:p("input",{attributes:{type:"text"},events:{input(){if(ce){const e=~he-1;ce.landmarks[e].id=this.value;const t=z.getRow(e).children[2].children[0].children[0];if(!t)throw"No button element is defined at mapName.landmarkID!";t.innerText=this.value}}}}),landmarkMap:p("input",{attributes:{type:"number"},events:{input(){ce&&(ce.landmarks[~he-1].map=parseInt(this.value))}}})};var W=[(new r).attachElement(p("div",{append:p("a",{text:S("inspector.selection.none"),attributes:{href:"https://github.com/WatDuhHekBro/CCAreaEditor#controls"}})})),(new r).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.map.name")}),V.mapName]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.map.path")}),V.mapPath,p("p",{text:S("inspector.selection.map.path.note")})]})),(new r).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.connection.position")}),p("span",{text:"("}),V.connectionX,p("span",{text:", "}),V.connectionY,p("span",{text:")"})]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.connection.direction")}),V.connectionDirection]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.connection.size")}),V.connectionSize]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.connection.maps")}),V.connectionMap1,V.connectionMap2]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.connection.condition")}),V.connectionCondition]})),(new r).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.icon.position")}),p("span",{text:"("}),V.iconX,p("span",{text:", "}),V.iconY,p("span",{text:")"})]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.icon.icon")}),V.iconType]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.icon.map")}),V.iconMap]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.icon.data")}),p("span",{text:S("inspector.selection.icon.data.area")+": "}),V.iconDataArea,p("br"),p("span",{text:S("inspector.selection.icon.data.map")+": "}),V.iconDataMap,p("p",{text:S("inspector.selection.icon.data.note")})]})),(new r).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.landmark.position")}),p("span",{text:"("}),V.landmarkX,p("span",{text:", "}),V.landmarkY,p("span",{text:")"})]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.landmark.id")}),V.landmarkID]})).attachElement(p("div",{append:[p("h2",{text:S("inspector.selection.landmark.map")}),V.landmarkMap]}))];let G=0;function Z(e,t){const n=document.createElement("span");return n.innerText=e,n.onclick=t,n}function q(e){var t;G=e;for(let n=0;n<ee.length;n++)null===(t=ee[n])||void 0===t||t.setDisplay(n===e),n===e&&(Q.title.innerText=S("inspector."+te[n]))}const Q=Object.assign(Object.assign(Object.assign(Object.assign({title:p("h1"),selected:p("span",{text:"N/A",classes:["rainbow","padded"]})},N),M),X),V),ee=[R,F,J,...W],te=["transfer","area","floor","selection","selection.map","selection.connection","selection.icon","selection.landmark"],ne=[];ee.forEach(e=>ne.push(e.getElement())),q(0);var oe=p("div",{classes:["ui"],append:[p("h1",{text:S("inspector")}),p("div",{classes:["separator"],append:[Z(S("inspector.tabs.transfer"),()=>{q(0)}),Z(S("inspector.tabs.area"),()=>{q(1)}),Z(S("inspector.tabs.floor"),()=>{q(2)}),Z(S("inspector.tabs.selection"),()=>{q(3+pe)})]}),Q.title,...ne,p("div",{classes:["fixed"],append:[p("span",{text:S("inspector.floor.selected")+": "}),Q.selected]})],events:{wheel:e=>e.stopPropagation(),keydown:e=>e.stopPropagation()}});class ie{constructor(e){var t,n,o,i,a;if(this.width=null!==(t=null==e?void 0:e.width)&&void 0!==t?t:1,this.height=null!==(n=null==e?void 0:e.height)&&void 0!==n?n:1,this.floors=[],(null===(o=null==e?void 0:e.floors)||void 0===o?void 0:o.length)>0)for(const t of null==e?void 0:e.floors)this.floors.push(T.from(t));else this.addFloor();this.defaultFloor=null==e?void 0:e.defaultFloor,Q.width.value=this.width.toString(),Q.height.value=this.height.toString(),Q.defaultFloor.value=null!==(a=null===(i=this.defaultFloor)||void 0===i?void 0:i.toString())&&void 0!==a?a:""}getFloorByIndex(e){if(e<0||e>=this.floors.length)throw`A floor by the index ${e} was attempted to be fetched but no floor by that index exists!`;return this.floors[e]}getFloorByLevel(e){for(const t of this.floors)if(e===t.level)return t}getIndexByLevel(e){for(let t=0;t<this.floors.length;t++)if(e===this.floors[t].level)return t;return-1}resize(e,t,n=0,o=0){if(e<0||t<0)throw new RangeError("You cannot resize the area to be less than 0 in width or height!");for(const i of this.floors)i.resize(e,t,n,o);this.width=e,this.height=t,Q.width.value=e.toString(),Q.height.value=t.toString()}addFloor(e){let t=0;if(this.floors.length>0){const n=null!=e?e:this.floors.length;t=n>=this.floors.length?this.floors[n-1].level+1:this.floors[n].level-1}c(this.floors,new T(t,this.width,this.height),e)}moveFloor(e,t){d(this.floors,e,t)}swapFloors(e,t){u(this.floors,e,t)}removeFloor(e){h(this.floors,e)}getWidth(){return this.width}getHeight(){return this.height}getAmountOfFloors(){return this.floors.length}}let ae=null;function se(e){ae=e,we()}var re;!function(e){e[e.TILES=0]="TILES",e[e.CONNECTIONS=1]="CONNECTIONS",e[e.RESULT=2]="RESULT"}(re||(re={}));const le=Object.keys(re).length/2;let ce,de=0,ue=re.TILES,he=0,pe=0,fe=!1;const ve=[[0],[1],[2,3]];function me(e,t){ce&&(ue===re.TILES?ce.render(!1,{isolate:e,select:t}):ue===re.CONNECTIONS?ce.render(!0,{debugConnectionsMode:!0,isolate:e,select:t}):ue===re.RESULT&&ce.render(!0,{isolate:e,select:t}))}function ge(e,t){se(new ie({width:e,height:t})),we()}function we(){var e,t;if(ae){de=null!==(t=ae.getIndexByLevel(null!==(e=ae.defaultFloor)&&void 0!==e?e:0))&&void 0!==t?t:0,ce=ae.getFloorByIndex(de),ye(de),gt.bind(),O.clearRows();for(let e=ae.getAmountOfFloors();e--;)O.addRow();We(),Je()}else console.warn("Tried to load an area without first initializing it!")}function xe(){gt.generateNewPalette(),me()}function be(e){ye(de+e)}function ye(e=de){if(ae&&ce&&e>=0&&e<ae.getAmountOfFloors()){ce=ae.getFloorByIndex(e),de=e,Q.level.value=ce.level.toString(),me(),ce.handle?j(ce.handle):$(),D.clearRows(),B.clearRows(),P.clearRows(),z.clearRows();for(let e=0;e<ce.maps.length;e++)D.addRow();for(let e=0;e<ce.connections.length;e++)B.addRow();for(let e=0;e<ce.icons.length;e++)P.addRow();for(let e=0;e<ce.landmarks.length;e++)z.addRow();he=ue===re.TILES?0:-1,We()}}function Se(){ae&&ce&&(ae.addFloor(),ye())}function Te(e){ae&&ce&&(ae.removeFloor(e),0===ae.getAmountOfFloors()?(ae.addFloor(),Q.level.value=ce.level.toString(),O.addRow()):de===ae.getAmountOfFloors()&&de--,ye())}function Ie(e,t){ae&&ce&&(ae.swapFloors(e,t),ye())}function Ee(){null==ce||ce.addMap("",y.untitled)}function _e(e){null==ce||ce.removeMap(e),me()}function Ce(e,t){null==ce||ce.swapMaps(e,t)}function ke(){null==ce||ce.addConnection(0,0,0,0,1,!1)}function Ue(e){null==ce||ce.removeConnection(e),me()}function Ne(e,t){null==ce||ce.swapConnections(e,t)}function Le(){null==ce||ce.addIcon("arrow_up",0,0,0)}function Re(e){null==ce||ce.removeIcon(e),me()}function Me(e,t){null==ce||ce.swapIcons(e,t)}function Oe(){null==ce||ce.addLandmark("landmark",0,0,0)}function Fe(e){null==ce||ce.removeLandmark(e),me()}function Ae(e,t){null==ce||ce.swapLandmarks(e,t)}function De(e,t){ce&&ue===re.TILES&&(ce.setTile(e,t,he),gt.setTile(e,t,he))}function Be(e,t,n,o){if(ce&&ue===re.TILES){if(n<e){const t=e;e=n,n=t}if(o<t){const e=t;t=o,o=e}for(let i=t;i<=o;i++)for(let t=e;t<=n;t++)ce.setTile(t,i,he);me()}}function Pe(e,t,n,o){if(ce&&ue===re.TILES){if(me(),n<e){const t=e;e=n,n=t}if(o<t){const e=t;t=o,o=e}for(let i=t;i<=o;i++)for(let t=e;t<=n;t++)gt.setTile(t,i,he)}}function ze(e){var t,n;ae?ae.resize(null!==(t=e.width)&&void 0!==t?t:ae.getWidth(),null!==(n=e.height)&&void 0!==n?n:ae.getHeight(),e.offsetX,e.offsetY):se(new ie({width:e.width,height:e.height})),me()}function Ye(e,t,n=!1){if(ce&&ue===re.CONNECTIONS){const o=ce.getConnectionByIndex(he);if(o){o.tx=e,o.ty=t,n||(Q.connectionX.value=e.toString(),Q.connectionY.value=t.toString());const i=B.getRow(he).children[2].children[0].children[0];if(!i)throw"No button element is defined at Gateway.moveConnection!";i.innerText=`(${e}, ${t})`,me()}}}function Xe(e=!1){if(ce&&ue===re.CONNECTIONS){const t=ce.getConnectionByIndex(he);if(t){const n="VERTICAL"===t.dir?"HORIZONTAL":"VERTICAL";t.dir=n,e&&(Q.connectionDirection.value=n),me()}}}function je(e,t,n=!1){if(ce&&ue===re.CONNECTIONS){const o=ce.getConnectionByIndex(he);if(o){const i="VERTICAL"===o.dir,a=Math.max(e-o.tx+1,1),s=Math.max(t-o.ty+1,1),r=i?a:s;o.size=r,n||(Q.connectionSize.value=r.toString()),me()}}}function $e(e,t){if(ce&&ue===re.RESULT){const n=he<-1,o=n?ce.getLandmarkByIndex(~he-1):ce.getIconByIndex(he);o&&(o.x=e,o.y=t,n?(Q.landmarkX.value=e.toString(),Q.landmarkY.value=t.toString()):(Q.iconX.value=e.toString(),Q.iconY.value=t.toString()),me())}}function He(e){"number"==typeof e&&e in re?ue=e:(ue++,ue>=le&&(ue=0)),he=ue===re.TILES?0:-1,We(),Je(),me()}function Je(){const e=ve[ue];for(let t=0;t<Y.length;t++){Y[t].setDisplay(e.includes(t))}}function Ke(e,t,n){if((!n||ue===n)&&ce){const n=Math.floor(e/8),o=Math.floor(t/8);ue===re.TILES?he=ce.getMapIndexByPosition(n,o):ue===re.CONNECTIONS?he=ce.getConnectionIndexByPosition(n,o):ue===re.RESULT&&(he=ce.getIconIndexByPosition(e,t)),We()}}function Ve(e){he=e,We()}function We(){let e,t=!1;ue===re.TILES?(Q.selected.innerText=(he-1).toString(),e=0!==he):(Q.selected.innerText=-1===he?"N/A":(he<-1?~he-1:he).toString(),e=-1!==he,t=he<-1),pe=(e?ue+1:0)+ +t,G>=3&&q(3+pe),function(){var e,t,n,o,i;if(!ce)throw"Gateway.setSelectedData was called outside of an active context!";if(1===pe&&ue===re.TILES){const e=ce.maps[he-1];K.setLangLabel(e.name),Q.mapPath.value=e.path}else if(2===pe&&ue===re.CONNECTIONS){const t=ce.connections[he];Q.connectionX.value=t.tx.toString(),Q.connectionY.value=t.ty.toString(),Q.connectionDirection.value=t.dir,Q.connectionSize.value=t.size.toString(),Q.connectionMap1.value=t.map1.toString(),Q.connectionMap2.value=t.map2.toString(),Q.connectionCondition.value=null!==(e=t.condition)&&void 0!==e?e:""}else if(3===pe&&ue===re.RESULT){const e=ce.icons[he];Q.iconX.value=e.x.toString(),Q.iconY.value=e.y.toString(),Q.iconType.value=e.icon,Q.iconMap.value=e.map.toString(),Q.iconDataArea.value=null!==(n=null===(t=e.data)||void 0===t?void 0:t.area)&&void 0!==n?n:"",Q.iconDataMap.value=null!==(i=null===(o=e.data)||void 0===o?void 0:o.map)&&void 0!==i?i:""}else if(4===pe&&ue===re.RESULT){const e=ce.landmarks[~he-1];Q.landmarkX.value=e.x.toString(),Q.landmarkY.value=e.y.toString(),Q.landmarkID.value=e.id,Q.landmarkMap.value=e.map.toString()}}()}function Ge(e,t){if(ce&&-1!==he&&ue!==re.TILES){const n=Math.floor(e/8),o=Math.floor(t/8),i=ce.getMapIndexByPosition(n,o)-1;if(ue===re.CONNECTIONS){const e=ce.connections[he];fe=!fe,fe?(e.map1=i,Q.connectionMap1.value=i.toString()):(e.map2=i,Q.connectionMap2.value=i.toString())}else if(ue===re.RESULT){const e=he<-1,t=e?~he-1:he;if(e){ce.landmarks[t].map=i,Q.landmarkMap.value=i.toString()}else{ce.icons[t].map=i,Q.iconMap.value=i.toString()}}}}function Ze(){if(ce)if(ue===re.TILES)me([he],he);else if(ue===re.CONNECTIONS){const e=ce.getConnectionByIndex(he);e&&me([e.map1+1,e.map2+1],he)}else if(ue===re.RESULT){const e=he<-1?ce.getLandmarkByIndex(~he-1):ce.getIconByIndex(he);e&&me([e.map+1],he)}}function qe(e,t){gt.movePosition(e,t)}function Qe(){gt.resetPosition(),gt.setZoom(1)}function et(e){gt.changeZoom(e)}let tt=!1,nt=!1,ot=!1,it=0,at=0,st=0,rt=0,lt=!1;const ct={Minus:()=>et(-1),Equal:()=>et(1),KeyQ:()=>be(-1),KeyE:()=>be(1),ArrowUp:e=>qe(0,e?-100:-50),ArrowDown:e=>qe(0,e?100:50),ArrowLeft:e=>qe(e?-100:-50,0),ArrowRight:e=>qe(e?100:50,0),KeyR:()=>Qe(),Digit1:()=>He(re.TILES),Digit2:()=>He(re.CONNECTIONS),Digit3:()=>He(re.RESULT)};function dt(e){const t=e.offsetX,n=e.offsetY,o=Math.floor(t/8),i=Math.floor(n/8),a=e.shiftKey;0===e.button?(Ke(t,n,re.CONNECTIONS),Ke(t,n,re.RESULT),a?(it=o,at=i,st=o,rt=i,Pe(o,i,o,i)):De(o,i),tt=!0,lt=!1):1===e.button?(e.preventDefault(),e.stopImmediatePropagation(),pt.start(t,n),ot=!0):2===e.button&&(nt=!0,a?Ge(t,n):ft.start(t,n))}function ut(e){const t=e.offsetX,n=e.offsetY,o=Math.floor(t/8),i=Math.floor(n/8),a=e.shiftKey;tt&&(o!==st&&i!==rt&&(a?(st=o,rt=i,Pe(it,at,o,i),je(o,i)):(De(o,i),Ye(o,i),$e(t,n))),lt=!0),ot&&pt.move(t,n),nt&&(a||ft.move(t,n))}function ht(e){const t=e.offsetX,n=e.offsetY,o=Math.floor(t/8),i=Math.floor(n/8),a=e.shiftKey;tt&&(a&&Be(it,at,o,i),lt||Xe()),ot&&pt.stop(t,n),nt&&(a||ft.stop(t,n)),tt=!1,ot=!1,nt=!1}const pt={lastX:0,lastY:0,start(e,t){this.lastX=e,this.lastY=t},move(e,t){const n=e-this.lastX,o=t-this.lastY;qe(n,o),this.lastX=e-n,this.lastY=t-o},stop(e,t){}},ft={start(e,t){Ke(e,t),Ze()},move(e,t){},stop(e,t){me()}},vt=new Image;vt.src="tiles.png";const mt=new Image;mt.src="icons.png";var gt=new class{constructor(){this.container=document.createElement("div"),this.container.classList.add("center"),this.background=document.createElement("canvas"),this.foreground=document.createElement("canvas"),this.container.appendChild(this.background),this.container.appendChild(this.foreground),this.contextBG=this.background.getContext("2d"),this.contextFG=this.foreground.getContext("2d"),this.context=this.contextBG,this.width=8,this.height=8,this.offsetX=0,this.offsetY=0,this.factor=1,this.pushTransform(),this.generateTiles(a.from([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),[1]),this.resetPosition()}setTile(e,t,n,o=!1){this.context&&!this.isOutOfBounds(e,t)&&(this.context.fillStyle=o?"#"+n.toString(16).padStart(6,"0"):i.getColor(n),this.context.fillRect(8*e,8*t,8,8))}drawTile(e,t,n){if(this.context&&!this.isOutOfBounds(e,t))for(const o of n)this.context.drawImage(vt,o[0]||0,o[1]||0,o[2]||8,o[3]||8,8*e+(o[4]||0),8*t+(o[5]||0),o[2]||8,o[3]||8)}drawIcon(e,t,n){var o;if(!(n in xt))throw`"${n}" is not a valid icon name!`;if(this.context&&!this.isOutOfBounds(e/8,t/8)){const i=xt[n];null===(o=this.context)||void 0===o||o.drawImage(mt,i[0]||0,i[1]||0,i[2]||12,i[3]||12,e+(i[4]||-6),t+(i[5]||-6),i[2]||12,i[3]||12)}}setRenderingMode(e){this.context=e?this.contextFG:this.contextBG}isOutOfBounds(e,t){return e<0||e>=this.width/8||t<0||t>=this.height/8}setSize(e,t){this.width=8*e,this.height=8*t,this.background.width=this.width,this.background.height=this.height,this.foreground.width=this.width,this.foreground.height=this.height,this.container.style.width=this.width+"px",this.container.style.height=this.height+"px"}movePosition(e,t){this.factor>=1&&(this.offsetX+=e,this.offsetY+=t,this.pushTransform())}resetPosition(){this.offsetX=0,this.offsetY=0,this.pushTransform()}setZoom(e){if(e%1!=0)throw`Renderer.setZoom(${e}) was called with a non-integer number!`;this.factor=e,this.pushTransform()}changeZoom(e){if(e%1!=0)throw`Renderer.changeZoom(${e}) was called with a non-integer number!`;this.factor+=e,this.factor<1&&(this.factor=1),this.pushTransform()}pushTransform(){let e=this.factor;e<=0&&(e=Math.abs(1/(e-2))),this.container.style.transform=`translate(-50%, -50%) translate(${this.offsetX}px, ${this.offsetY}px) scale(${e})`}generateTiles(e,t){this.setSize(e.getWidth(),e.getHeight()),e.iterate((e,n,o)=>{t?this.setTile(e,n,t.includes(o)?16777215:0,!0):this.setTile(e,n,o)})}generateTilesAdvanced(e,t){const n=e.getWidth(),o=e.getHeight();this.setSize(n,o);for(let i=0;i<o;i++)for(let a=0;a<n;a++){const s=e.get(a,i);if(void 0!==s)if(0===s||t&&!t.includes(s))this.drawTile(a,i,wt.void);else{const t=0!==i&&e.get(a,i-1)===s,r=i!==o-1&&e.get(a,i+1)===s,l=0!==a&&e.get(a-1,i)===s,c=a!==n-1&&e.get(a+1,i)===s,d=0!==i&&0!==a&&e.get(a-1,i-1)!==s,u=0!==i&&a!==n-1&&e.get(a+1,i-1)!==s,h=i!==o-1&&0!==a&&e.get(a-1,i+1)!==s,p=i!==o-1&&a!==n-1&&e.get(a+1,i+1)!==s;this.drawTile(a,i,wt.tiles[+t<<3|+r<<2|+l<<1|+c]),t&&l&&d&&this.drawTile(a,i,wt.vertex.nw),t&&c&&u&&this.drawTile(a,i,wt.vertex.ne),r&&l&&h&&this.drawTile(a,i,wt.vertex.sw),r&&c&&p&&this.drawTile(a,i,wt.vertex.se)}else console.warn(`Point (${a}, ${i}) was outside of the grid!`)}}drawConnection(e,t,n=!1,o=1){const i=n?"vertical":"horizontal";this.drawTile(e,t,wt.connection[i].main);for(let a=1;a<Math.max(1,o);a++){let o=n?a:0,s=n?0:a,r=n?a-1:0,l=n?0:a-1;this.drawTile(e+o,t+s,wt.connection[i].main),this.drawTile(e+r,t+l,wt.connection[i].extend)}}drawDebugConnection(e,t,n=!1,o=1){if(this.setTile(e,t,16711680,!0),n){this.setTile(e,t+1,65280,!0);for(let n=1;n<o;n++)this.setTile(e+n,t,255,!0),this.setTile(e+n,t+1,255,!0)}else{this.setTile(e+1,t,65280,!0);for(let n=1;n<o;n++)this.setTile(e,t+n,255,!0),this.setTile(e+1,t+n,255,!0)}}getIconBounds(e,t,n){if(!(n in xt))throw`"${n}" is not a valid icon name!`;const o=xt[n],i=e+(o[4]||-6),a=t+(o[5]||-6);return[i,a,i+(o[2]||12),a+(o[3]||12)]}generateNewPalette(){i.generateNewPalette()}bind(){!function(e){e.onmousedown=dt,e.onmousemove=ut,e.onmouseup=ht,e.onmouseleave=ht,window.onwheel=e=>{const t=e.shiftKey;e.deltaY<0?t?be(1):et(1):e.deltaY>0&&(t?be(-1):et(-1))},e.oncontextmenu=e=>e.preventDefault(),window.onkeydown=e=>{e.code in ct&&ct[e.code](e.shiftKey)}}(this.container)}attach(){document.body.appendChild(this.container)}};const wt={void:[[0,0,8,8]],voidLarge:[[0,0,16,16]],tiles:[[[40,0]],[[16,0,8,4],[16,12,8,4,0,4]],[[24,0,8,4],[24,12,8,4,0,4]],[[20,0,8,4],[20,12,8,4,0,4]],[[16,0,4,8],[28,0,4,8,4,0]],[[16,0]],[[24,0]],[[20,0]],[[16,8,4,8],[28,8,4,8,4,0]],[[16,8]],[[24,8]],[[20,8]],[[16,4,4,8],[28,4,4,8,4,0]],[[16,4]],[[24,4]],[[20,4]]],vertex:{nw:[[32,0,4,4,0,0]],ne:[[36,0,4,4,4,0]],sw:[[32,4,4,4,0,4]],se:[[36,4,4,4,4,4]]},connection:{vertical:{main:[[40,8,8,2,0,6],[40,10,8,3,0,8]],extend:[[17,3,8,2,4,6],[17,3,8,3,4,8]]},horizontal:{main:[[32,8,3,8,5,0],[35,8,2,8,8,0]],extend:[[17,3,3,8,5,4],[17,3,2,8,8,4]]}}},xt={arrow_up:[0,0],arrow_down:[12,0],arrow_left:[24,0],arrow_right:[36,0],floor_down:[48,0],weapons:[60,0],quest:[72,0],entrance:[84,0],chest:[96,0],area_up:[0,12],area_down:[12,12],area_left:[24,12],area_right:[36,12],shop:[48,12],trader:[60,12],quest_hub:[72,12],landmark:[84,12,16,16,-7,-8]},bt=Object.keys(xt);for(const e of bt)Q.iconType.appendChild(p("option",{text:e}));const yt=p("select",{events:{change(){Et(this.value)}},append:p("option")}),St=p("div",{text:S("preferences.language.note")}),Tt=p("input",{attributes:{type:"text",style:"width: 50px",placeholder:"en_US"}});for(const e of b)yt.appendChild(p("option",{text:x(e),attributes:{value:e}}));yt.value=f.language;var It=p("div",{classes:["ui","sidebar"],append:[p("h1",{text:S("preferences")}),p("h2",{text:S("preferences.language")}),p("div",{append:[St,p("div",{append:[yt,Tt,p("button",{text:S("preferences.language.submit"),events:{click(){Et(Tt.value),yt.value="",Tt.value=""}}})]})]})],events:{wheel:e=>e.stopPropagation(),keydown:e=>e.stopPropagation()}});function Et(e){const t=function(e,t,n=""){let o="",i=!1,a="";for(const s of e)"%"===s?(i&&(""===a?o+="%":(o+=a in t?t[a]:null==n?`%${a}%`:n,a="")),i=!i):i?a+=s:o+=s;return o}(S(f.set("language",e)?"preferences.language.success":"preferences.language.failure"),{language_name:x(e),language_tag:e});St.innerText=t,setTimeout(()=>St.innerText=S("preferences.language.note"),3e3)}gt.attach(),document.body.appendChild(oe),document.body.appendChild(It),document.body.ondrop=function(e){if(e.preventDefault(),e.dataTransfer)for(const t of e.dataTransfer.items){const e=t.getAsFile();if(e&&e.name.endsWith(".json")){k=e.name;const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=()=>{U(t.result)}}}},document.body.ondragover=e=>e.preventDefault(),Object.assign(window,{Renderer:gt,Gateway:o,Settings:f})}]);