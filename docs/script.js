!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t){t.exports=JSON.parse('{"supportedLanguages":["en_US"],"languages":{"en_US":"English","de_DE":"Deutsch","zh_CN":"简体中文","ja_JP":"日本語","ko_KR":"한국어","zh_TW":"繁體中文","ru_RU":"Русский","fr_FR":"Français"},"title":{"en_US":"CrossCode Area Editor","ko_KR":"크로스코드 지역 에디터"},"floor.upper":{"en_US":"F","de_DE":"E","zh_CN":"层","ja_JP":"階","ko_KR":"층","zh_TW":"層"},"floor.ground":{"en_US":"GF","de_DE":"EG","zh_CN":"基层","ja_JP":"地階","ko_KR":"지상","zh_TW":"基層"},"floor.lower":{"en_US":"U","de_DE":"U","zh_CN":"U","ja_JP":"地下","ko_KR":"U","zh_TW":"U"},"inspector":{"en_US":"Inspector","ko_KR":"인스펙터"},"inspector.tabs.transfer":{"en_US":"Transfer"},"inspector.tabs.area":{"en_US":"Area"},"inspector.tabs.floor":{"en_US":"Floor"},"inspector.tabs.selection":{"en_US":"Selected"},"inspector.transfer":{"en_US":"Create/Load Area"},"inspector.transfer.note":{"en_US":"You can either create an area or load an existing one. To load an existing area, you can either copy and paste its data or upload it. To get the area from the editor, you can either copy it from the text field or download it."},"inspector.transfer.create":{"en_US":"Create New Area"},"inspector.transfer.textfield":{"en_US":"Text Field"},"inspector.transfer.textfield.paste":{"en_US":"Transferred into editor!"},"inspector.transfer.textfield.copy":{"en_US":"Copy"},"inspector.transfer.textfield.copy.status":{"en_US":"Copied to clipboard!"},"inspector.transfer.textfield.note":{"en_US":"Copy and paste a valid area JSON file here to load it into the editor."},"inspector.transfer.textfield.placeholder":{"en_US":"Paste JSON here."},"inspector.transfer.upload":{"en_US":"Upload"},"inspector.transfer.upload.note":{"en_US":"You can also drag and drop an area JSON file anywhere to load it into the editor."},"inspector.transfer.download":{"en_US":"Download"},"inspector.area":{"en_US":"Area Settings"},"inspector.area.genericListNote":{"en_US":"To add an entry, click the [+] button to add a new entry at that location. Likewise, click the [-] button to remove that entry. You can also select two entries and click the \\"Swap\\" button."},"inspector.area.dimensions":{"en_US":"Dimensions"},"inspector.area.move":{"en_US":"Move Current Grid"},"inspector.area.dimensions.confirm":{"en_US":"Set these as my new dimensions and offsets."},"inspector.area.defaultFloor":{"en_US":"Default Floor"},"inspector.area.defaultFloor.note":{"en_US":"This setting determines the first floor you see when viewing this area from another area."},"inspector.area.floors":{"en_US":"Floors"},"inspector.area.floors.swap":{"en_US":"Swap Floors"},"inspector.area.floors.swap.success":{"en_US":"Successfully swapped the two selected floors!"},"inspector.area.floors.swap.failure":{"en_US":"You need to select exactly two floors in order to swap them!"},"inspector.area.note":{"en_US":"Note: Area metadata is stored in \\"assets/data/database.json/areas/<area>/...\\". This is where properties like the amount of chests in the area, names/descriptions, and its position on the global map are stored. The area data structure itself is for storing the grid and any other grid-specific data like maps, connections, icons, and landmarks."},"inspector.floor":{"en_US":"Floor Settings"},"inspector.floor.level":{"en_US":"Level"},"inspector.floor.level.note":{"en_US":"The level property only determines the display of this floor in the floor buttons. So you can have -2 then -4, which will show up in that order. A default floor property that doesn\'t match anything will just show a blank screen until you select a floor."},"inspector.floor.maps":{"en_US":"Maps"},"inspector.floor.connections":{"en_US":"Connections"},"inspector.floor.icons":{"en_US":"Icons"},"inspector.floor.landmarks":{"en_US":"Landmarks"},"inspector.floor.genericSelect":{"en_US":"Select"},"inspector.floor.handle":{"en_US":"Custom Handler"},"inspector.floor.handle.note":{"en_US":"This will override the level property so instead of displaying \\"F5\\", you can instead display \\"F??\\" with this setting."},"inspector.selection.map":{"en_US":"Current Map"},"inspector.selection.map.path":{"en_US":"Path"},"inspector.selection.map.name":{"en_US":"Map Name"},"inspector.selection.map.name.untitled":{"en_US":"untitled","de_DE":"unbetitelt","zh_CN":"未命名","ja_JP":"無題","ko_KR":"미정","zh_TW":"未命名"},"inspector.selection.map.note":{"en_US":"The path requires a specific format to work properly. For example, \\"arid.town-1\\", which points to \\"assets/data/maps/arid/town-1.json\\"."},"inspector.selection.connection":{"en_US":"Current Connection"},"inspector.selection.connection.position":{"en_US":"Position"},"inspector.selection.connection.direction":{"en_US":"Direction"},"inspector.selection.connection.size":{"en_US":"Size"},"inspector.selection.connection.maps":{"en_US":"Bound Maps"},"inspector.selection.connection.condition":{"en_US":"Condition (optional)"},"inspector.selection.icon":{"en_US":"Current Icon"},"inspector.selection.icon.position":{"en_US":"Position"},"inspector.selection.icon.icon":{"en_US":"Icon"},"inspector.selection.icon.map":{"en_US":"Bound Map"},"inspector.selection.icon.data":{"en_US":"Icon Metadata"},"inspector.selection.icon.data.area":{"en_US":"Area"},"inspector.selection.icon.data.map":{"en_US":"Map"},"inspector.selection.icon.data.note":{"en_US":"This is required for area pointer icons. For the area field, put in the area identifier (like \\"arid-dng-2\\") and the map that it\'s pointing to (like \\"arid-dng.first.room-01\\")."},"inspector.selection.landmark":{"en_US":"Current Landmark"},"inspector.selection.landmark.position":{"en_US":"Position"},"inspector.selection.landmark.id":{"en_US":"ID"},"inspector.selection.landmark.map":{"en_US":"Bound Map"},"preferences":{"en_US":"Preferences"},"preferences.language":{"en_US":"Language"},"preferences.language.note":{"en_US":"This setting will be used to determine both the language that will appear in this program (if it\'s supported) as well as the default language that appears when you edit a map\'s name. Below, you\'ll see two fields: The first is a dropdown menu of all the fully-supported languages. The second is a text field where you can enter in any language code such as \\"en_US\\" in order to automatically switch to that language when editing map names. The two are intertwined."},"preferences.language.success":{"en_US":"Successfully set your language to %language_name% (%language_tag%)! Reload the page for these changes to take place."},"preferences.language.failure":{"en_US":"Failed to set your language to %language_name% (%language_tag%)! Your browser most likely doesn\'t support the local storage module."},"help":{"en_US":"Need some help?"},"help.controls":{"en_US":"Controls: %link%"},"error":{"en_US":"There are currently some errors with the program! Press F12 to list out what those errors were and submit an issue on GitHub."}}')},function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"VIEWS",(function(){return _})),n.d(o,"render",(function(){return k})),n.d(o,"createArea",(function(){return L})),n.d(o,"loadArea",(function(){return N})),n.d(o,"setTile",(function(){return O})),n.d(o,"setBox",(function(){return A})),n.d(o,"setBoxPreview",(function(){return M})),n.d(o,"moveConnection",(function(){return R})),n.d(o,"rotateConnection",(function(){return F})),n.d(o,"resizeConnection",(function(){return B})),n.d(o,"moveIcon",(function(){return z})),n.d(o,"select",(function(){return P})),n.d(o,"highlight",(function(){return Y})),n.d(o,"panView",(function(){return D})),n.d(o,"resetView",(function(){return $})),n.d(o,"setView",(function(){return j})),n.d(o,"switchZoom",(function(){return X})),n.d(o,"switchFloor",(function(){return W}));var i=new class{constructor(){this.palette=[0]}getColor(t,e=!1){if(t<0)throw new RangeError(`Index out of bounds at getColor(${t})!`);t in this.palette||(this.palette[t]=Math.floor(16777216*Math.random()));const n=this.palette[t];return"#"+(e?function(t){if(t>16777215||t<0)throw new RangeError(`Color "${t}" provided to getInverse is not a valid RGB value!`);return 16777215&~t}(n):n).toString(16).padStart(6,"0")}generateNewPalette(){this.palette.splice(1)}};class s{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e)}static from(t){var e;const n=t.length,o=t[0].length,i=new s(o,n);for(let s=0;s<n;s++){t[s].length!==o&&console.warn("This matrix does not have the same width throughout!",t);for(let n=0;n<o;n++)i.set(n,s,null!==(e=t[s][n])&&void 0!==e?e:0)}return i}get(t,e){if(!(t>=this.width||t<0||e>=this.height||e<0))return this.data[this.width*e+t]}set(t,e,n){if(t>=this.width||t<0||e>=this.height||e<0)throw new RangeError(`Index out of bounds! Called (${t}, ${e}) of width ${this.width} x height ${this.height}.`);this.data[this.width*e+t]=n}resize(t,e,n=0,o=0){const i=new Uint8Array(t*e);for(let s=0;s<this.data.length;s++){const r=s%this.width+n,a=Math.floor(s/this.width)+o;r>=0&&r<t&&a>=0&&a<e&&(i[t*a+r]=this.data[s])}this.data=i,this.width=t,this.height=e}iterate(t){for(let e=0;e<this.data.length;e++){const n=t(e%this.width,Math.floor(e/this.width),this.data[e]);"number"==typeof n&&(this.data[e]=n)}}getWidth(){return this.width}getHeight(){return this.height}toJSON(){const t=new Array(this.height);for(let e=0;e<this.height;e++)t[e]=Array.from(this.data.slice(this.width*e,this.width*(e+1)));return t}}var r=new class{constructor(){var t,e;let n;try{n=JSON.parse(null!==(t=window.localStorage.getItem("CCAE"))&&void 0!==t?t:"{}")}catch(t){n={}}this.language=null!==(e=n.language)&&void 0!==e?e:"en_US",this.save()}set(t,e){return t in this&&(this[t]=e,this.save(),!0)}save(){window.localStorage.setItem("CCAE",JSON.stringify(this))}},a=n(0);class l{constructor(t){if(this.languages={en_US:""},t)for(const e in t)"langUid"!==e&&(this.languages[e]=t[e])}get(t=r.language){var e;return t in this.languages?this.languages[t]:null!==(e=this.languages.en_US)&&void 0!==e?e:""}getClean(t=r.language){let e=this.get(t);return/<<[AC]/g.test(e)&&(e=e.substring(0,e.search(/<<[AC]/g))),e}toJSON(){return this.languages}}a.supportedLanguages;delete a.supportedLanguages;const c={};for(const t in a)c[t]=new l(a[t]);function h(t,e){const n=c[t];return n?n.get(e):"N/A"}document.title=h("title");class d{constructor(t){this.element=t}attach(t){return this.element.appendChild(t.element),this}attachElement(t){return this.element.appendChild(t),this}attachTo(t){t.appendChild(this.element)}}function u(t,e,n){void 0!==n&&n<t.length?t.splice(n,0,e):t.push(e)}function f(t,e,n){t.splice(n,0,t.splice(e,1)[0])}function p(t,e){void 0!==e?t.splice(e,1):t.pop()}class m{constructor(t,e,n){if(this.level=t,e.constructor===s)this.tiles=e;else{if(e.constructor!==Number||!n)throw`Invalid constructor call to Floor! new Floor(${t}, ${e}, ${n})`;this.tiles=new s(e,n)}this.icons=[],this.maps=[],this.connections=[],this.landmarks=[]}static from(t){const e=new m(t.level,s.from(t.tiles));t.handle&&(e.handle=new l(t.handle));for(const n of t.maps)e.maps.push(new g(n));for(const n of t.connections)e.connections.push(new w(n));for(const n of t.icons)e.icons.push(new v(n));for(const n of t.landmarks)e.landmarks.push(new y(n));return e}setTile(t,e,n){if(n>this.maps.length)throw`Error: Attempted to place a tile with the value of ${n}, but the maximum allowed index is ${this.maps.length}! If you want to use more maps, you have to do so by calling Floor.addMap(...)!`;this.tiles.set(t,e,n)}getFloorName(){return this.handle?this.handle.getClean():0===this.level?h("floor.ground"):this.level>0?Math.abs(this.level)+h("floor.upper"):this.level<0?h("floor.lower")+Math.abs(this.level):"N/A"}render(t,e){if(lt.setRenderingMode(!1),t)if(lt.generateTilesAdvanced(this.tiles,null==e?void 0:e.isolate),lt.setRenderingMode(!0),null==e?void 0:e.debugConnectionsMode)for(let t=0;t<this.connections.length;t++){const n=this.connections[t];e.select&&t!==e.select||lt.drawDebugConnection(n.tx,n.ty,"VERTICAL"===n.dir,n.size)}else if(null==e?void 0:e.isolate){for(let t=0;t<this.icons.length;t++){const n=this.icons[t];!e.isolate.includes(n.map+1)||e.select&&t!==e.select||lt.drawIcon(n.x,n.y,n.icon)}for(let t=0;t<this.landmarks.length;t++){const n=this.landmarks[t];e.isolate.includes(n.map+1)&&lt.drawIcon(n.x,n.y,"landmark")}}else{for(const t of this.connections)lt.drawConnection(t.tx,t.ty,"VERTICAL"===t.dir,t.size);for(const t of this.icons)lt.drawIcon(t.x,t.y,t.icon);for(const t of this.landmarks)lt.drawIcon(t.x,t.y,"landmark")}else lt.generateTiles(this.tiles,null==e?void 0:e.isolate);lt.setRenderingMode(!0)}resize(t,e,n=0,o=0){if(this.tiles.resize(t,e,n,o),0!==n||0!==o){const t=[],e=[],i=[];for(let e=0;e<this.connections.length;e++){const i=this.connections[e];i.tx+=n,i.ty+=o,(i.tx<0||i.ty<0)&&t.push(e)}for(let t=0;t<this.icons.length;t++){const i=this.icons[t];i.x+=8*n,i.y+=8*o,(i.x<0||i.y<0)&&e.push(t)}for(let t=0;t<this.landmarks.length;t++){const e=this.landmarks[t];e.x+=8*n,e.y+=8*o,(e.x<0||e.y<0)&&i.push(t)}for(const e of t)this.removeConnection(e);for(const t of e)this.removeIcon(t);for(const t of i)this.removeLandmark(t)}}addMap(t,e,n){u(this.maps,new g({path:t,name:e}),n)}moveMap(t,e){f(this.maps,t,e)}removeMap(t){p(this.maps,t)}addConnection(t,e,n,o,i,s,r){u(this.connections,new w({tx:t,ty:e,dir:s?"VERTICAL":"HORIZONTAL",size:i,map1:n,map2:o}),r)}moveConnection(t,e){f(this.connections,t,e)}removeConnection(t){p(this.connections,t)}addIcon(t,e,n,o,i){u(this.icons,new v({icon:t,x:e,y:n,map:o}),i)}moveIcon(t,e){f(this.icons,t,e)}removeIcon(t){p(this.icons,t)}addLandmark(t,e,n,o,i){u(this.landmarks,new y({id:t,x:e,y:n,map:o}),i)}moveLandmark(t,e){f(this.landmarks,t,e)}removeLandmark(t){p(this.icons,t)}getMapIndexByPosition(t,e){var n;return null!==(n=this.tiles.get(t,e))&&void 0!==n?n:-1}getConnectionIndexByPosition(t,e){for(let n=0;n<this.connections.length;n++){const o=this.connections[n],i="VERTICAL"===o.dir,s=o.tx,r=o.ty,a=i?s+o.size-1:s+1,l=i?r+1:r+o.size-1;if(t>=s&&t<=a&&e>=r&&e<=l)return n}return-1}getIconIndexByPosition(t,e){for(let n=0;n<this.icons.length;n++){const o=this.icons[n],[i,s,r,a]=lt.getIconBounds(o.x,o.y,o.icon);if(t>=i&&t<=r&&e>=s&&e<=a)return n}for(let n=0;n<this.landmarks.length;n++){const o=this.landmarks[n],[i,s,r,a]=lt.getIconBounds(o.x,o.y,"landmark");if(t>=i&&t<=r&&e>=s&&e<=a)return~n-1}return-1}getMapByIndex(t){return this.maps[t]}getConnectionByIndex(t){return this.connections[t]}getIconByIndex(t){return this.icons[t]}getLandmarkByIndex(t){return this.landmarks[t]}}class g{constructor(t){var e;this.path=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"",this.name=new l(null==t?void 0:t.name)}}class w{constructor(t){var e,n,o,i,s;this.tx=null!==(e=null==t?void 0:t.tx)&&void 0!==e?e:0,this.ty=null!==(n=null==t?void 0:t.ty)&&void 0!==n?n:0,this.dir=["HORIZONTAL","VERTICAL"].includes(null==t?void 0:t.dir)?null==t?void 0:t.dir:"HORIZONTAL",this.size=null!==(o=null==t?void 0:t.size)&&void 0!==o?o:1,this.map1=null!==(i=null==t?void 0:t.map1)&&void 0!==i?i:0,this.map2=null!==(s=null==t?void 0:t.map2)&&void 0!==s?s:0,this.condition=null==t?void 0:t.condition,this.offset=null==t?void 0:t.offset}}class v{constructor(t){var e,n,o,i;this.icon=null!==(e=null==t?void 0:t.icon)&&void 0!==e?e:"chest",this.x=null!==(n=null==t?void 0:t.x)&&void 0!==n?n:0,this.y=null!==(o=null==t?void 0:t.y)&&void 0!==o?o:0,this.map=null!==(i=null==t?void 0:t.map)&&void 0!==i?i:0,this.data=null==t?void 0:t.data}}class y{constructor(t){var e,n,o,i;this.id=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:"",this.x=null!==(n=null==t?void 0:t.x)&&void 0!==n?n:0,this.y=null!==(o=null==t?void 0:t.y)&&void 0!==o?o:0,this.map=null!==(i=null==t?void 0:t.map)&&void 0!==i?i:0}}class S{constructor(t){var e,n,o;if(this.width=null!==(e=null==t?void 0:t.width)&&void 0!==e?e:1,this.height=null!==(n=null==t?void 0:t.height)&&void 0!==n?n:1,this.floors=[],(null===(o=null==t?void 0:t.floors)||void 0===o?void 0:o.length)>0)for(const e of null==t?void 0:t.floors)this.floors.push(m.from(e));else this.addFloor();this.defaultFloor=null==t?void 0:t.defaultFloor}getFloorByIndex(t){if(t<0||t>=this.floors.length)throw`A floor by the index ${t} was attempted to be fetched but no floor by that index exists!`;return this.floors[t]}getFloorByLevel(t){for(const e of this.floors)if(t===e.level)return e}getIndexByLevel(t){for(let e=0;e<this.floors.length;e++)if(t===this.floors[e].level)return e}resize(t,e,n=0,o=0){if(t<0||e<0)throw new RangeError("You cannot resize the area to be less than 0 in width or height!");for(const i of this.floors)i.resize(t,e,n,o);this.width=t,this.height=e}addFloor(t){let e=0;if(this.floors.length>0){const n=null!=t?t:this.floors.length;e=n>=this.floors.length?this.floors[n-1].level+1:this.floors[n].level-1}u(this.floors,new m(e,this.width,this.height),t)}moveFloor(t,e){f(this.floors,t,e)}removeFloor(t){p(this.floors,t)}getWidth(){return this.width}getHeight(){return this.height}getAmountOfFloors(){return this.floors.length}}let x=null;function T(t){x=t,N()}var _;!function(t){t[t.TILES=0]="TILES",t[t.CONNECTIONS=1]="CONNECTIONS",t[t.RESULT=2]="RESULT"}(_||(_={}));const b=Object.keys(_).length/2;let U,C=0,I=_.TILES,E=0;function k(t,e){U&&(I===_.TILES?U.render(!1,{isolate:t,select:e}):I===_.CONNECTIONS?U.render(!0,{debugConnectionsMode:!0,isolate:t,select:e}):I===_.RESULT&&U.render(!0,{isolate:t,select:e}))}function L(t,e){T(new S({width:t,height:e})),N()}function N(){var t,e,n,o;x?(U=null!==(e=x.getFloorByLevel(null!==(t=x.defaultFloor)&&void 0!==t?t:0))&&void 0!==e?e:x.getFloorByIndex(0),C=null!==(o=x.getIndexByLevel(null!==(n=x.defaultFloor)&&void 0!==n?n:0))&&void 0!==o?o:0,k(),lt.bind()):console.warn("Tried to load an area without first initializing it!")}function O(t,e){U&&I===_.TILES&&(U.setTile(t,e,E),lt.setTile(t,e,E))}function A(t,e,n,o){if(U&&I===_.TILES){if(n<t){const e=t;t=n,n=e}if(o<e){const t=e;e=o,o=t}for(let i=e;i<=o;i++)for(let e=t;e<=n;e++)U.setTile(e,i,E);k()}}function M(t,e,n,o){if(U&&I===_.TILES){if(k(),n<t){const e=t;t=n,n=e}if(o<e){const t=e;e=o,o=t}for(let i=e;i<=o;i++)for(let e=t;e<=n;e++)lt.setTile(e,i,E)}}function R(t,e){if(U&&I===_.CONNECTIONS){const n=U.getConnectionByIndex(E);n&&(n.tx=t,n.ty=e,k())}}function F(){if(U&&I===_.CONNECTIONS){const t=U.getConnectionByIndex(E);if(t){const e="VERTICAL"===t.dir;t.dir=e?"HORIZONTAL":"VERTICAL",k()}}}function B(t,e){if(U&&I===_.CONNECTIONS){const n=U.getConnectionByIndex(E);if(n){const o="VERTICAL"===n.dir,i=Math.max(t-n.tx+1,1),s=Math.max(e-n.ty+1,1);n.size=o?i:s,console.log(o,i,s),k()}}}function z(t,e){if(U&&I===_.RESULT){const n=E<-1?U.getLandmarkByIndex(~E-1):U.getIconByIndex(E);n&&(n.x=t,n.y=e,k())}}function P(t,e,n){if((!n||I===n)&&U){const n=Math.floor(t/8),o=Math.floor(e/8);I===_.TILES?E=U.getMapIndexByPosition(n,o):I===_.CONNECTIONS?E=U.getConnectionIndexByPosition(n,o):I===_.RESULT&&(E=U.getIconIndexByPosition(t,e))}}function Y(){if(U)if(I===_.TILES)k([E],E);else if(I===_.CONNECTIONS){const t=U.getConnectionByIndex(E);t&&k([t.map1+1,t.map2+1],E)}else if(I===_.RESULT){const t=E<-1?U.getLandmarkByIndex(~E-1):U.getIconByIndex(E);t&&k([t.map+1],E)}}function D(t,e){lt.movePosition(t,e)}function $(){lt.resetPosition(),lt.setZoom(1)}function j(t){"number"==typeof t&&t in _?I=t:(I++,I>=b&&(I=0)),E=0,k()}function X(t){lt.changeZoom(t)}function W(t){if(x&&U){const e=C+t;e>=0&&e<x.getAmountOfFloors()&&(U=x.getFloorByIndex(e),C=e,k())}}let J=!1,K=!1,V=!1,G=0,Z=0,H=0,q=0,Q=!1;const tt={Minus:()=>X(-1),Equal:()=>X(1),KeyQ:()=>W(-1),KeyE:()=>W(1),ArrowUp:t=>D(0,t?-100:-50),ArrowDown:t=>D(0,t?100:50),ArrowLeft:t=>D(t?-100:-50,0),ArrowRight:t=>D(t?100:50,0),KeyR:()=>$(),Digit1:()=>j(_.TILES),Digit2:()=>j(_.CONNECTIONS),Digit3:()=>j(_.RESULT)};function et(t){const e=t.offsetX,n=t.offsetY,o=Math.floor(e/8),i=Math.floor(n/8),s=t.shiftKey;0===t.button?(P(e,n,_.CONNECTIONS),P(e,n,_.RESULT),s?(G=o,Z=i,H=o,q=i,M(o,i,o,i)):O(o,i),J=!0,Q=!1):1===t.button?(t.preventDefault(),t.stopImmediatePropagation(),it.start(e,n),V=!0):2===t.button&&(st.start(e,n),K=!0)}function nt(t){const e=t.offsetX,n=t.offsetY,o=Math.floor(e/8),i=Math.floor(n/8),s=t.shiftKey;J&&(o!==H&&i!==q&&(s?(H=o,q=i,M(G,Z,o,i),B(o,i)):(O(o,i),R(o,i),z(e,n))),Q=!0),V&&it.move(e,n),K&&st.move(e,n)}function ot(t){const e=t.offsetX,n=t.offsetY,o=Math.floor(e/8),i=Math.floor(n/8),s=t.shiftKey;J&&(s&&A(G,Z,o,i),Q||F()),V&&it.stop(e,n),K&&st.stop(e,n),J=!1,V=!1,K=!1}const it={lastX:0,lastY:0,start(t,e){this.lastX=t,this.lastY=e},move(t,e){const n=t-this.lastX,o=e-this.lastY;D(n,o),this.lastX=t-n,this.lastY=e-o},stop(t,e){}},st={start(t,e){P(t,e),Y()},move(t,e){},stop(t,e){k()}},rt=new Image;rt.src="tiles.png";const at=new Image;at.src="icons.png";var lt=new class{constructor(){this.container=document.createElement("div"),this.container.classList.add("center"),this.background=document.createElement("canvas"),this.foreground=document.createElement("canvas"),this.container.appendChild(this.background),this.container.appendChild(this.foreground),this.contextBG=this.background.getContext("2d"),this.contextFG=this.foreground.getContext("2d"),this.context=this.contextBG,this.width=8,this.height=8,this.offsetX=0,this.offsetY=0,this.factor=1,this.pushTransform(),this.generateTiles(s.from([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),[1]),this.resetPosition()}setTile(t,e,n,o=!1){this.context&&!this.isOutOfBounds(t,e)&&(this.context.fillStyle=o?"#"+n.toString(16).padStart(6,"0"):i.getColor(n),this.context.fillRect(8*t,8*e,8,8))}drawTile(t,e,n){if(this.context&&!this.isOutOfBounds(t,e))for(const o of n)this.context.drawImage(rt,o[0]||0,o[1]||0,o[2]||8,o[3]||8,8*t+(o[4]||0),8*e+(o[5]||0),o[2]||8,o[3]||8)}drawIcon(t,e,n){var o;if(!(n in ht))throw`"${n}" is not a valid icon name!`;if(this.context&&!this.isOutOfBounds(t/8,e/8)){const i=ht[n];null===(o=this.context)||void 0===o||o.drawImage(at,i[0]||0,i[1]||0,i[2]||12,i[3]||12,t+(i[4]||-6),e+(i[5]||-6),i[2]||12,i[3]||12)}}setRenderingMode(t){this.context=t?this.contextFG:this.contextBG}isOutOfBounds(t,e){return t<0||t>=this.width/8||e<0||e>=this.height/8}setSize(t,e){this.width=8*t,this.height=8*e,this.background.width=this.width,this.background.height=this.height,this.foreground.width=this.width,this.foreground.height=this.height,this.container.style.width=this.width+"px",this.container.style.height=this.height+"px"}movePosition(t,e){this.factor>=1&&(this.offsetX+=t,this.offsetY+=e,this.pushTransform())}resetPosition(){this.offsetX=0,this.offsetY=0,this.pushTransform()}setZoom(t){if(t%1!=0)throw`Renderer.setZoom(${t}) was called with a non-integer number!`;this.factor=t,this.pushTransform()}changeZoom(t){if(t%1!=0)throw`Renderer.changeZoom(${t}) was called with a non-integer number!`;this.factor+=t,this.factor<1&&(this.factor=1),this.pushTransform()}pushTransform(){let t=this.factor;t<=0&&(t=Math.abs(1/(t-2))),this.container.style.transform=`translate(-50%, -50%) translate(${this.offsetX}px, ${this.offsetY}px) scale(${t})`}generateTiles(t,e){this.setSize(t.getWidth(),t.getHeight()),t.iterate((t,n,o)=>{e?this.setTile(t,n,e.includes(o)?16777215:0,!0):this.setTile(t,n,o)})}generateTilesAdvanced(t,e){const n=t.getWidth(),o=t.getHeight();this.setSize(n,o);for(let i=0;i<o;i++)for(let s=0;s<n;s++){const r=t.get(s,i);if(void 0!==r)if(0===r||e&&!e.includes(r))this.drawTile(s,i,ct.void);else{const e=0!==i&&t.get(s,i-1)===r,a=i!==o-1&&t.get(s,i+1)===r,l=0!==s&&t.get(s-1,i)===r,c=s!==n-1&&t.get(s+1,i)===r,h=0!==i&&0!==s&&t.get(s-1,i-1)!==r,d=0!==i&&s!==n-1&&t.get(s+1,i-1)!==r,u=i!==o-1&&0!==s&&t.get(s-1,i+1)!==r,f=i!==o-1&&s!==n-1&&t.get(s+1,i+1)!==r;this.drawTile(s,i,ct.tiles[+e<<3|+a<<2|+l<<1|+c]),e&&l&&h&&this.drawTile(s,i,ct.vertex.nw),e&&c&&d&&this.drawTile(s,i,ct.vertex.ne),a&&l&&u&&this.drawTile(s,i,ct.vertex.sw),a&&c&&f&&this.drawTile(s,i,ct.vertex.se)}else console.warn(`Point (${s}, ${i}) was outside of the grid!`)}}drawConnection(t,e,n=!1,o=1){const i=n?"vertical":"horizontal";this.drawTile(t,e,ct.connection[i].main);for(let s=1;s<Math.max(1,o);s++){let o=n?s:0,r=n?0:s,a=n?s-1:0,l=n?0:s-1;this.drawTile(t+o,e+r,ct.connection[i].main),this.drawTile(t+a,e+l,ct.connection[i].extend)}}drawDebugConnection(t,e,n=!1,o=1){if(this.setTile(t,e,16711680,!0),n){this.setTile(t,e+1,65280,!0);for(let n=1;n<o;n++)this.setTile(t+n,e,255,!0),this.setTile(t+n,e+1,255,!0)}else{this.setTile(t+1,e,65280,!0);for(let n=1;n<o;n++)this.setTile(t,e+n,255,!0),this.setTile(t+1,e+n,255,!0)}}getIconBounds(t,e,n){if(!(n in ht))throw`"${n}" is not a valid icon name!`;const o=ht[n],i=t+(o[4]||-6),s=e+(o[5]||-6);return[i,s,i+(o[2]||12),s+(o[3]||12)]}bind(){var t;(t=this.container).onmousedown=et,t.onmousemove=nt,t.onmouseup=ot,t.onmouseleave=ot,window.onwheel=t=>{const e=t.shiftKey;t.deltaY<0?e?W(1):X(1):t.deltaY>0&&(e?W(-1):X(-1))},t.oncontextmenu=t=>t.preventDefault(),window.onkeydown=t=>{t.code in tt&&tt[t.code](t.shiftKey)}}attach(){document.body.appendChild(this.container)}};const ct={void:[[0,0,8,8]],voidLarge:[[0,0,16,16]],tiles:[[[40,0]],[[16,0,8,4],[16,12,8,4,0,4]],[[24,0,8,4],[24,12,8,4,0,4]],[[20,0,8,4],[20,12,8,4,0,4]],[[16,0,4,8],[28,0,4,8,4,0]],[[16,0]],[[24,0]],[[20,0]],[[16,8,4,8],[28,8,4,8,4,0]],[[16,8]],[[24,8]],[[20,8]],[[16,4,4,8],[28,4,4,8,4,0]],[[16,4]],[[24,4]],[[20,4]]],vertex:{nw:[[32,0,4,4,0,0]],ne:[[36,0,4,4,4,0]],sw:[[32,4,4,4,0,4]],se:[[36,4,4,4,4,4]]},connection:{vertical:{main:[[40,8,8,2,0,6],[40,10,8,3,0,8]],extend:[[17,3,8,2,4,6],[17,3,8,3,4,8]]},horizontal:{main:[[32,8,3,8,5,0],[35,8,2,8,8,0]],extend:[[17,3,3,8,5,4],[17,3,2,8,8,4]]}}},ht={arrow_up:[0,0],arrow_down:[12,0],arrow_left:[24,0],arrow_right:[36,0],floor_down:[48,0],weapons:[60,0],quest:[72,0],entrance:[84,0],chest:[96,0],area_up:[0,12],area_down:[12,12],area_left:[24,12],area_right:[36,12],shop:[48,12],trader:[60,12],quest_hub:[72,12],landmark:[84,12,16,16,-7,-8]};let dt="area.json";function ut(t){try{T(new S(JSON.parse(t)))}catch(t){T(new S)}}function ft(t){if(t.preventDefault(),t.dataTransfer)for(const e of t.dataTransfer.items){const t=e.getAsFile();if(t&&t.name.endsWith(".json")){dt=t.name;const e=new FileReader;e.readAsText(t,"UTF-8"),e.onload=()=>{ut(e.result)}}}}function pt(){var t;const e=null===(t=this.files)||void 0===t?void 0:t[0];if(null==e?void 0:e.name.endsWith(".json")){const t=new FileReader;dt=e.name,t.readAsText(e,"UTF-8"),t.onload=()=>{ut(t.result)}}}function mt(){ut(this.value),this.value=h("inspector.transfer.textfield.paste")}function gt(){if(x){const t=document.createElement("a");t.download=dt,t.href=window.URL.createObjectURL(new Blob([JSON.stringify(x)],{type:"text/plain"})),t.click(),t.remove()}}class wt extends d{constructor(){super(document.createElement("input")),this.element.type="file",this.element.onchange=pt}}class vt extends d{constructor(){super(document.createElement("input")),this.element.oninput=mt,this.element.placeholder=h("inspector.transfer.textfield.placeholder")}}class yt extends d{constructor(){super(document.createElement("button")),this.element.onclick=gt,this.element.innerText=h("inspector.transfer.download")}}class St extends d{constructor(){super(document.createElement("div")),this.isWindowed=!1,this.lastX=0,this.lastY=0,this.isActivelyMoving=!1,this.offsetX=0,this.offsetY=0,this.tag="map",this.element.classList.add("ui");const t=document.createElement("h1");t.innerText=h("inspector"),this.element.appendChild(t);const e=document.createElement("div");e.classList.add("separator"),this.element.appendChild(e),this.tabs=[],this.titleTab=document.createElement("h1"),this.element.appendChild(this.titleTab);const n=new xt,o=document.createElement("input");o.type="number";const i=document.createElement("span");i.innerText=" x ";const s=document.createElement("input");s.type="number";const r=document.createElement("span");r.innerText="".padStart(5," ");const a=document.createElement("button");a.innerText=h("inspector.transfer.create"),a.onclick=()=>{L(parseInt(o.value),parseInt(s.value))},n.attachElement(o).attachElement(i).attachElement(s).attachElement(r).attachElement(a).attach(new vt).attach(new wt).attach(new yt),this.attach(n),this.tabs.push(n),e.appendChild(Tt(h("inspector.tabs.transfer"),()=>{this.setActiveTab(0)}));const l=new xt;this.attach(l),this.tabs.push(l),e.appendChild(Tt(h("inspector.tabs.area"),()=>{this.setActiveTab(1)}));const c=new xt;this.attach(c),this.tabs.push(c),e.appendChild(Tt(h("inspector.tabs.floor"),()=>{this.setActiveTab(2)}));const d=new xt;this.attach(d),this.tabs.push(d),e.appendChild(Tt(h("inspector.tabs.selection"),()=>{this.setActiveTab(3)}));const u=document.createElement("span");u.className="corner-button",u.innerText="⚪",u.onclick=()=>{this.setWindowedMode()},this.element.appendChild(u),this.element.onmousedown=t=>{1===t.button&&(t.preventDefault(),t.stopImmediatePropagation(),this.lastX=t.offsetX,this.lastY=t.offsetY,this.isActivelyMoving=!0)},this.element.onmousemove=t=>{if(this.isActivelyMoving&&this.isWindowed){const e=t.offsetX,n=t.offsetY,o=e-this.lastX,i=n-this.lastY;this.offsetX+=o,this.offsetY+=i,this.lastX=e-o,this.lastY=n-i,this.element.style.transform=`translate(${this.offsetX}px, ${this.offsetY}px)`}},this.element.onmouseup=t=>{this.isActivelyMoving=!1},this.element.onmouseleave=t=>{this.isActivelyMoving=!1},this.setActiveTab(0),this.setWindowedMode(!0)}setActiveTab(t){var e;for(let n=0;n<this.tabs.length;n++){const o=3===n?"."+this.tag:"";null===(e=this.tabs[n])||void 0===e||e.setDisplay(n===t),n===t&&(this.titleTab.innerText=h(`inspector.${St.tabNames[n]}${o}`))}}setWindowedMode(t){const e=null!=t?t:!this.isWindowed;this.isWindowed=e,this.element.style.transform="",this.offsetX=0,this.offsetY=0,e?(this.element.classList.add("window"),this.element.classList.remove("sidebar")):(this.element.classList.add("sidebar"),this.element.classList.remove("window"))}}St.tabNames=["transfer","area","floor","selection"];class xt extends d{constructor(){super(document.createElement("div")),this.enabled=!0,this.setDisplay(!1)}attach(t){const e=document.createElement("div");return t.attachTo(e),super.attachElement(e),this}setDisplay(t){const e=null!=t?t:!this.enabled;this.enabled=e,this.element.style.display=e?"block":"none"}}function Tt(t,e){const n=document.createElement("span");return n.innerText=t,n.onclick=e,n}var _t=new St;lt.attach(),document.body.ondrop=ft,document.body.ondragover=t=>t.preventDefault(),_t.attachTo(document.body),Object.assign(window,{Renderer:lt,Gateway:o,Settings:r})}]);