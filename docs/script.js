!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t){t.exports=JSON.parse('{"supportedLanguages":["en_US"],"languages":{"en_US":"English","de_DE":"Deutsch","zh_CN":"简体中文","ja_JP":"日本語","ko_KR":"한국어","zh_TW":"繁體中文","ru_RU":"Русский","fr_FR":"Français"},"title":{"en_US":"CrossCode Area Editor","ko_KR":"크로스코드 지역 에디터"},"floor.upper":{"en_US":"F","de_DE":"E","zh_CN":"层","ja_JP":"階","ko_KR":"층","zh_TW":"層"},"floor.ground":{"en_US":"GF","de_DE":"EG","zh_CN":"基层","ja_JP":"地階","ko_KR":"지상","zh_TW":"基層"},"floor.lower":{"en_US":"U","de_DE":"U","zh_CN":"U","ja_JP":"地下","ko_KR":"U","zh_TW":"U"},"inspector":{"en_US":"Inspector","ko_KR":"인스펙터"},"inspector.genericListNote":{"en_US":"To add an entry, click the [+] button to add a new entry at that location. Likewise, click the [-] button to remove that entry. You can also select two entries and click the \\"Swap\\" button."},"inspector.tabs.transfer":{"en_US":"Transfer"},"inspector.tabs.area":{"en_US":"Area"},"inspector.tabs.floor":{"en_US":"Floor"},"inspector.tabs.selection":{"en_US":"Selection"},"inspector.transfer":{"en_US":"Transfer Data"},"inspector.transfer.note":{"en_US":"Here is where you can import existing data or export data from the editor for use in-game. To create a new area, go into the \\"Area\\" tab and set the area\'s dimensions there. Here, you can import an existing area by either copying and pasting the data or by uploading it. To export the area from the editor, you can either copy it from the text field or download it."},"inspector.transfer.textfield.paste":{"en_US":"Transferred into editor!"},"inspector.transfer.textfield.copy":{"en_US":"Copy"},"inspector.transfer.textfield.copy.status":{"en_US":"Copied to clipboard!"},"inspector.transfer.textfield.placeholder":{"en_US":"Paste JSON here."},"inspector.transfer.upload.note":{"en_US":"You can also drag and drop an area JSON file anywhere to load it into the editor."},"inspector.transfer.download":{"en_US":"Download"},"inspector.area":{"en_US":"Area Settings"},"inspector.area.width":{"en_US":"Width"},"inspector.area.height":{"en_US":"Height"},"inspector.area.offsetX":{"en_US":"Offset X"},"inspector.area.offsetY":{"en_US":"Offset Y"},"inspector.area.confirm":{"en_US":"Confirm"},"inspector.area.defaultFloor":{"en_US":"Default Floor"},"inspector.area.defaultFloor.note":{"en_US":"This setting determines the first floor you see when viewing this area from another area."},"inspector.area.floors":{"en_US":"Floors"},"inspector.area.floors.swap":{"en_US":"Swap Floors"},"inspector.area.floors.swap.success":{"en_US":"Successfully swapped the two selected floors!"},"inspector.area.floors.swap.failure":{"en_US":"You need to select exactly two floors in order to swap them!"},"inspector.area.note":{"en_US":"Note: Area metadata is stored in \\"assets/data/database.json/areas/<area>/...\\". This is where properties like the amount of chests in the area, names/descriptions, and its position on the global map are stored. The area data structure itself is for storing the grid and any other grid-specific data like maps, connections, icons, and landmarks."},"inspector.floor":{"en_US":"Floor Settings"},"inspector.floor.level":{"en_US":"Level"},"inspector.floor.level.note":{"en_US":"The level property only determines the display of this floor in the floor buttons. So you can have -2 then -4, which will show up in that order. A default floor property that doesn\'t match anything will just show a blank screen until you select a floor."},"inspector.floor.handle":{"en_US":"Custom Handler"},"inspector.floor.handle.note":{"en_US":"This will override the level property so instead of displaying \\"F5\\", you can instead display \\"F??\\" with this setting."},"inspector.floor.handle.add":{"en_US":"Add"},"inspector.floor.handle.remove":{"en_US":"Remove"},"inspector.floor.maps":{"en_US":"Maps"},"inspector.floor.connections":{"en_US":"Connections"},"inspector.floor.icons":{"en_US":"Icons"},"inspector.floor.landmarks":{"en_US":"Landmarks"},"inspector.floor.select":{"en_US":"Select"},"inspector.selection":{"en_US":"Current Selection"},"inspector.selection.map.path":{"en_US":"Path"},"inspector.selection.map.name":{"en_US":"Map Name"},"inspector.selection.map.name.untitled":{"en_US":"untitled","de_DE":"unbetitelt","zh_CN":"未命名","ja_JP":"無題","ko_KR":"미정","zh_TW":"未命名"},"inspector.selection.map.note":{"en_US":"The path requires a specific format to work properly. For example, \\"arid.town-1\\", which points to \\"assets/data/maps/arid/town-1.json\\"."},"inspector.selection.connection.position":{"en_US":"Position"},"inspector.selection.connection.direction":{"en_US":"Direction"},"inspector.selection.connection.size":{"en_US":"Size"},"inspector.selection.connection.maps":{"en_US":"Bound Maps"},"inspector.selection.connection.condition":{"en_US":"Condition (optional)"},"inspector.selection.icon.position":{"en_US":"Position"},"inspector.selection.icon.icon":{"en_US":"Icon"},"inspector.selection.icon.map":{"en_US":"Bound Map"},"inspector.selection.icon.data":{"en_US":"Icon Metadata"},"inspector.selection.icon.data.area":{"en_US":"Area"},"inspector.selection.icon.data.map":{"en_US":"Map"},"inspector.selection.icon.data.note":{"en_US":"This is required for area pointer icons. For the area field, put in the area identifier (like \\"arid-dng-2\\") and the map that it\'s pointing to (like \\"arid-dng.first.room-01\\")."},"inspector.selection.landmark.position":{"en_US":"Position"},"inspector.selection.landmark.id":{"en_US":"ID"},"inspector.selection.landmark.map":{"en_US":"Bound Map"},"preferences":{"en_US":"Preferences"},"preferences.language":{"en_US":"Language"},"preferences.language.note":{"en_US":"This setting will be used to determine both the language that will appear in this program (if it\'s supported) as well as the default language that appears when you edit a map\'s name. Below, you\'ll see two fields: The first is a dropdown menu of all the fully-supported languages. The second is a text field where you can enter in any language code such as \\"en_US\\" in order to automatically switch to that language when editing map names. The two are intertwined."},"preferences.language.success":{"en_US":"Successfully set your language to %language_name% (%language_tag%)! Reload the page for these changes to take place."},"preferences.language.failure":{"en_US":"Failed to set your language to %language_name% (%language_tag%)! Your browser most likely doesn\'t support the local storage module."},"help":{"en_US":"Need some help?"},"help.controls":{"en_US":"Controls: %link%"},"error":{"en_US":"There are currently some errors with the program! Press F12 to list out what those errors were and submit an issue on GitHub."}}')},function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"VIEWS",(function(){return R})),n.d(o,"currentFloor",(function(){return B})),n.d(o,"render",(function(){return Y})),n.d(o,"createArea",(function(){return D})),n.d(o,"loadArea",(function(){return j})),n.d(o,"setTile",(function(){return $})),n.d(o,"setBox",(function(){return X})),n.d(o,"setBoxPreview",(function(){return J})),n.d(o,"resizeArea",(function(){return K})),n.d(o,"moveConnection",(function(){return H})),n.d(o,"rotateConnection",(function(){return W})),n.d(o,"resizeConnection",(function(){return V})),n.d(o,"moveIcon",(function(){return Z})),n.d(o,"select",(function(){return G})),n.d(o,"selectById",(function(){return q})),n.d(o,"highlight",(function(){return Q})),n.d(o,"panView",(function(){return tt})),n.d(o,"resetView",(function(){return et})),n.d(o,"setView",(function(){return nt})),n.d(o,"switchZoom",(function(){return ot})),n.d(o,"switchFloor",(function(){return it}));var i=new class{constructor(){this.palette=[0]}getColor(t,e=!1){if(t<0)throw new RangeError(`Index out of bounds at getColor(${t})!`);t in this.palette||(this.palette[t]=Math.floor(16777216*Math.random()));const n=this.palette[t];return"#"+(e?function(t){if(t>16777215||t<0)throw new RangeError(`Color "${t}" provided to getInverse is not a valid RGB value!`);return 16777215&~t}(n):n).toString(16).padStart(6,"0")}generateNewPalette(){this.palette.splice(1)}};class s{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e)}static from(t){var e;const n=t.length,o=t[0].length,i=new s(o,n);for(let s=0;s<n;s++){t[s].length!==o&&console.warn("This matrix does not have the same width throughout!",t);for(let n=0;n<o;n++)i.set(n,s,null!==(e=t[s][n])&&void 0!==e?e:0)}return i}get(t,e){if(!(t>=this.width||t<0||e>=this.height||e<0))return this.data[this.width*e+t]}set(t,e,n){if(t>=this.width||t<0||e>=this.height||e<0)throw new RangeError(`Index out of bounds! Called (${t}, ${e}) of width ${this.width} x height ${this.height}.`);this.data[this.width*e+t]=n}resize(t,e,n=0,o=0){const i=new Uint8Array(t*e);for(let s=0;s<this.data.length;s++){const r=s%this.width+n,a=Math.floor(s/this.width)+o;r>=0&&r<t&&a>=0&&a<e&&(i[t*a+r]=this.data[s])}this.data=i,this.width=t,this.height=e}iterate(t){for(let e=0;e<this.data.length;e++){const n=t(e%this.width,Math.floor(e/this.width),this.data[e]);"number"==typeof n&&(this.data[e]=n)}}getWidth(){return this.width}getHeight(){return this.height}toJSON(){const t=new Array(this.height);for(let e=0;e<this.height;e++)t[e]=Array.from(this.data.slice(this.width*e,this.width*(e+1)));return t}}class r{constructor(t){this.element=t}attach(t){return this.element.appendChild(t.element),this}attachElement(t){return this.element.appendChild(t),this}attachTo(t){t.appendChild(this.element)}}function a(t,e,n){void 0!==n&&n<t.length?t.splice(n,0,e):t.push(e)}function l(t,e,n){t.splice(n,0,t.splice(e,1)[0])}function c(t,e){void 0!==e?t.splice(e,1):t.pop()}function h(t,e){const n=document.createElement(t);if((null==e?void 0:e.text)&&(n.innerText=e.text),null==e?void 0:e.classes)for(const t of e.classes)n.classList.add(t);if(null==e?void 0:e.attributes)for(const t in e.attributes)n.setAttribute(t,e.attributes[t]);if(null==e?void 0:e.events)for(const t in e.events)n.addEventListener(t,e.events[t]);if(null==e?void 0:e.append)if(Array.isArray(e.append))for(const t of e.append)n.appendChild(t);else n.appendChild(e.append);return n}var d=new class{constructor(){var t,e;let n;try{n=JSON.parse(null!==(t=window.localStorage.getItem("CCAE"))&&void 0!==t?t:"{}")}catch(t){n={}}this.language=null!==(e=n.language)&&void 0!==e?e:"en_US",this.save()}set(t,e){return t in this&&(this[t]=e,this.save(),!0)}save(){window.localStorage.setItem("CCAE",JSON.stringify(this))}},u=n(0);class f{constructor(t){if(this.languages={en_US:""},t)for(const e in t)"langUid"!==e&&(this.languages[e]=t[e])}get(t=d.language){var e;return t in this.languages?this.languages[t]:null!==(e=this.languages.en_US)&&void 0!==e?e:""}getClean(t=d.language){let e=this.get(t);return/<<[AC]/g.test(e)&&(e=e.substring(0,e.search(/<<[AC]/g))),e}toJSON(){return this.languages}}u.supportedLanguages;delete u.supportedLanguages;const p={};for(const t in u)p[t]=new f(u[t]);function g(t,e){const n=p[t];return n?n.get(e):"N/A"}document.title=g("title");class m{constructor(t,e,n){if(this.level=t,e.constructor===s)this.tiles=e;else{if(e.constructor!==Number||!n)throw`Invalid constructor call to Floor! new Floor(${t}, ${e}, ${n})`;this.tiles=new s(e,n)}this.icons=[],this.maps=[],this.connections=[],this.landmarks=[]}static from(t){const e=new m(t.level,s.from(t.tiles));t.handle&&(e.handle=new f(t.handle));for(const n of t.maps)e.maps.push(new v(n));for(const n of t.connections)e.connections.push(new w(n));for(const n of t.icons)e.icons.push(new y(n));for(const n of t.landmarks)e.landmarks.push(new S(n));return e}setTile(t,e,n){if(n>this.maps.length)throw`Error: Attempted to place a tile with the value of ${n}, but the maximum allowed index is ${this.maps.length}! If you want to use more maps, you have to do so by calling Floor.addMap(...)!`;this.tiles.set(t,e,n)}getFloorName(){return this.handle?this.handle.getClean():0===this.level?g("floor.ground"):this.level>0?Math.abs(this.level)+g("floor.upper"):this.level<0?g("floor.lower")+Math.abs(this.level):"N/A"}render(t,e){if(xt.setRenderingMode(!1),t)if(xt.generateTilesAdvanced(this.tiles,null==e?void 0:e.isolate),xt.setRenderingMode(!0),null==e?void 0:e.debugConnectionsMode)for(let t=0;t<this.connections.length;t++){const n=this.connections[t];e.select&&t!==e.select||xt.drawDebugConnection(n.tx,n.ty,"VERTICAL"===n.dir,n.size)}else if(null==e?void 0:e.isolate){for(let t=0;t<this.icons.length;t++){const n=this.icons[t];!e.isolate.includes(n.map+1)||e.select&&t!==e.select||xt.drawIcon(n.x,n.y,n.icon)}for(let t=0;t<this.landmarks.length;t++){const n=this.landmarks[t];e.isolate.includes(n.map+1)&&xt.drawIcon(n.x,n.y,"landmark")}}else{for(const t of this.connections)xt.drawConnection(t.tx,t.ty,"VERTICAL"===t.dir,t.size);for(const t of this.icons)xt.drawIcon(t.x,t.y,t.icon);for(const t of this.landmarks)xt.drawIcon(t.x,t.y,"landmark")}else xt.generateTiles(this.tiles,null==e?void 0:e.isolate);xt.setRenderingMode(!0)}resize(t,e,n=0,o=0){if(this.tiles.resize(t,e,n,o),0!==n||0!==o){const t=[],e=[],i=[];for(let e=0;e<this.connections.length;e++){const i=this.connections[e];i.tx+=n,i.ty+=o,(i.tx<0||i.ty<0)&&t.push(e)}for(let t=0;t<this.icons.length;t++){const i=this.icons[t];i.x+=8*n,i.y+=8*o,(i.x<0||i.y<0)&&e.push(t)}for(let t=0;t<this.landmarks.length;t++){const e=this.landmarks[t];e.x+=8*n,e.y+=8*o,(e.x<0||e.y<0)&&i.push(t)}for(const e of t)this.removeConnection(e);for(const t of e)this.removeIcon(t);for(const t of i)this.removeLandmark(t)}}addMap(t,e,n){a(this.maps,new v({path:t,name:e}),n)}moveMap(t,e){l(this.maps,t,e)}removeMap(t){c(this.maps,t)}addConnection(t,e,n,o,i,s,r){a(this.connections,new w({tx:t,ty:e,dir:s?"VERTICAL":"HORIZONTAL",size:i,map1:n,map2:o}),r)}moveConnection(t,e){l(this.connections,t,e)}removeConnection(t){c(this.connections,t)}addIcon(t,e,n,o,i){a(this.icons,new y({icon:t,x:e,y:n,map:o}),i)}moveIcon(t,e){l(this.icons,t,e)}removeIcon(t){c(this.icons,t)}addLandmark(t,e,n,o,i){a(this.landmarks,new S({id:t,x:e,y:n,map:o}),i)}moveLandmark(t,e){l(this.landmarks,t,e)}removeLandmark(t){c(this.icons,t)}getMapIndexByPosition(t,e){var n;return null!==(n=this.tiles.get(t,e))&&void 0!==n?n:-1}getConnectionIndexByPosition(t,e){for(let n=0;n<this.connections.length;n++){const o=this.connections[n],i="VERTICAL"===o.dir,s=o.tx,r=o.ty,a=i?s+o.size-1:s+1,l=i?r+1:r+o.size-1;if(t>=s&&t<=a&&e>=r&&e<=l)return n}return-1}getIconIndexByPosition(t,e){for(let n=0;n<this.icons.length;n++){const o=this.icons[n],[i,s,r,a]=xt.getIconBounds(o.x,o.y,o.icon);if(t>=i&&t<=r&&e>=s&&e<=a)return n}for(let n=0;n<this.landmarks.length;n++){const o=this.landmarks[n],[i,s,r,a]=xt.getIconBounds(o.x,o.y,"landmark");if(t>=i&&t<=r&&e>=s&&e<=a)return~n-1}return-1}getMapByIndex(t){return this.maps[t]}getConnectionByIndex(t){return this.connections[t]}getIconByIndex(t){return this.icons[t]}getLandmarkByIndex(t){return this.landmarks[t]}}class v{constructor(t){var e;this.path=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"",this.name=new f(null==t?void 0:t.name)}}class w{constructor(t){var e,n,o,i,s;this.tx=null!==(e=null==t?void 0:t.tx)&&void 0!==e?e:0,this.ty=null!==(n=null==t?void 0:t.ty)&&void 0!==n?n:0,this.dir=["HORIZONTAL","VERTICAL"].includes(null==t?void 0:t.dir)?null==t?void 0:t.dir:"HORIZONTAL",this.size=null!==(o=null==t?void 0:t.size)&&void 0!==o?o:1,this.map1=null!==(i=null==t?void 0:t.map1)&&void 0!==i?i:0,this.map2=null!==(s=null==t?void 0:t.map2)&&void 0!==s?s:0,this.condition=null==t?void 0:t.condition,this.offset=null==t?void 0:t.offset}}class y{constructor(t){var e,n,o,i;this.icon=null!==(e=null==t?void 0:t.icon)&&void 0!==e?e:"chest",this.x=null!==(n=null==t?void 0:t.x)&&void 0!==n?n:0,this.y=null!==(o=null==t?void 0:t.y)&&void 0!==o?o:0,this.map=null!==(i=null==t?void 0:t.map)&&void 0!==i?i:0,this.data=null==t?void 0:t.data}}class S{constructor(t){var e,n,o,i;this.id=null!==(e=null==t?void 0:t.id)&&void 0!==e?e:"",this.x=null!==(n=null==t?void 0:t.x)&&void 0!==n?n:0,this.y=null!==(o=null==t?void 0:t.y)&&void 0!==o?o:0,this.map=null!==(i=null==t?void 0:t.map)&&void 0!==i?i:0}}let x="area.json";function _(t){try{F(new N(JSON.parse(t)))}catch(t){F(new N)}}class T extends r{constructor(){super(document.createElement("div")),this.enabled=!0,this.setDisplay(!1)}setDisplay(t){const e=null!=t?t:!this.enabled;return this.enabled=e,this.element.style.display=e?"block":"none",this}getElement(){return this.element}}function b(t,e){const n=document.createElement("span");return n.innerText=t,n.onclick=e,n}function U(t){var e;for(let n=0;n<C.length;n++)null===(e=C[n])||void 0===e||e.setDisplay(n===t),n===t&&(I.title.innerText=g("inspector."+k[n]))}const I={title:h("h1"),textfield:h("input",{attributes:{type:"text",placeholder:g("inspector.transfer.textfield.placeholder")},events:{input:function(){_(this.value),this.blur(),this.value="",this.placeholder=g("inspector.transfer.textfield.paste"),setTimeout(()=>this.placeholder=g("inspector.transfer.textfield.placeholder"),1500)}}}),width:h("input",{attributes:{type:"number",value:"1"}}),height:h("input",{attributes:{type:"number",value:"1"}}),offsetX:h("input",{attributes:{type:"number"}}),offsetY:h("input",{attributes:{type:"number"}}),defaultFloor:h("input",{attributes:{type:"number"},events:{input(){L?L.defaultFloor=parseInt(this.value):this.value=""}}}),level:h("input",{attributes:{type:"number"},events:{input(){B?B.level=parseInt(this.value):this.value=""}}})},C=[(new T).attachElement(h("div",{text:g("inspector.transfer.note")})).attachElement(h("div",{append:[I.textfield,h("button",{text:g("inspector.transfer.textfield.copy"),events:{click:(E=I.textfield,function(){L&&(E.value=JSON.stringify(L),E.select(),E.setSelectionRange(0,99999),document.execCommand("copy"),E.blur(),E.value="",E.placeholder=g("inspector.transfer.textfield.copy.status"),setTimeout(()=>E.placeholder=g("inspector.transfer.textfield.placeholder"),1500))})}})]})).attachElement(h("div",{append:[h("input",{attributes:{type:"file"},events:{change:function(){var t;const e=null===(t=this.files)||void 0===t?void 0:t[0];if(null==e?void 0:e.name.endsWith(".json")){const t=new FileReader;x=e.name,t.readAsText(e,"UTF-8"),t.onload=()=>{_(t.result)}}}}}),h("span",{text:g("inspector.transfer.upload.note")})]})).attachElement(h("div",{append:h("button",{text:g("inspector.transfer.download"),events:{click:function(){if(L){const t=document.createElement("a");t.download=x,t.href=window.URL.createObjectURL(new Blob([JSON.stringify(L)],{type:"text/plain"})),t.click(),t.remove()}}}})})).setDisplay(),(new T).attachElement(h("div",{append:[h("span",{text:g("inspector.area.width")+" "}),I.width,h("span",{text:" "+g("inspector.area.height")+" "}),I.height,h("br"),h("span",{text:g("inspector.area.offsetX")+" "}),I.offsetX,h("span",{text:" "+g("inspector.area.offsetY")+" "}),I.offsetY,h("br"),h("button",{text:g("inspector.area.confirm"),events:{click(){K({width:parseInt(I.width.value)||void 0,height:parseInt(I.height.value)||void 0,offsetX:parseInt(I.offsetX.value)||void 0,offsetY:parseInt(I.offsetY.value)||void 0}),I.offsetX.value="",I.offsetY.value=""}}})]})).attachElement(h("div",{append:[h("span",{text:g("inspector.area.defaultFloor")+" "}),I.defaultFloor,h("p",{text:g("inspector.area.defaultFloor.note")})]})).attachElement(h("div",{append:[h("h2",{text:g("inspector.area.floors")})]})).attachElement(h("div",{append:h("p",{text:g("inspector.area.note")})})),(new T).attachElement(h("div",{append:[h("span",{text:g("inspector.floor.level")+" "}),I.level,h("p",{text:g("inspector.floor.level.note")})]})).attachElement(h("div")).attachElement(h("div")).attachElement(h("div")).attachElement(h("div")),new T];var E;const k=["transfer","area","floor","selection"];U(0);var O=h("div",{classes:["ui"],append:[h("h1",{text:g("inspector")}),h("div",{classes:["separator"],append:[b(g("inspector.tabs.transfer"),()=>{U(0)}),b(g("inspector.tabs.area"),()=>{U(1)}),b(g("inspector.tabs.floor"),()=>{U(2)}),b(g("inspector.tabs.selection"),()=>{U(3)})]}),I.title,C[0].getElement(),C[1].getElement(),C[2].getElement(),C[3].getElement()]});class N{constructor(t){var e,n,o,i,s;if(this.width=null!==(e=null==t?void 0:t.width)&&void 0!==e?e:1,this.height=null!==(n=null==t?void 0:t.height)&&void 0!==n?n:1,this.floors=[],(null===(o=null==t?void 0:t.floors)||void 0===o?void 0:o.length)>0)for(const e of null==t?void 0:t.floors)this.floors.push(m.from(e));else this.addFloor();this.defaultFloor=null==t?void 0:t.defaultFloor,I.width.value=this.width.toString(),I.height.value=this.height.toString(),I.defaultFloor.value=null!==(s=null===(i=this.defaultFloor)||void 0===i?void 0:i.toString())&&void 0!==s?s:""}getFloorByIndex(t){if(t<0||t>=this.floors.length)throw`A floor by the index ${t} was attempted to be fetched but no floor by that index exists!`;return this.floors[t]}getFloorByLevel(t){for(const e of this.floors)if(t===e.level)return e}getIndexByLevel(t){for(let e=0;e<this.floors.length;e++)if(t===this.floors[e].level)return e}resize(t,e,n=0,o=0){if(t<0||e<0)throw new RangeError("You cannot resize the area to be less than 0 in width or height!");for(const i of this.floors)i.resize(t,e,n,o);this.width=t,this.height=e,I.width.value=t.toString(),I.height.value=e.toString()}addFloor(t){let e=0;if(this.floors.length>0){const n=null!=t?t:this.floors.length;e=n>=this.floors.length?this.floors[n-1].level+1:this.floors[n].level-1}a(this.floors,new m(e,this.width,this.height),t)}moveFloor(t,e){l(this.floors,t,e)}removeFloor(t){c(this.floors,t)}getWidth(){return this.width}getHeight(){return this.height}getAmountOfFloors(){return this.floors.length}}let L=null;function F(t){L=t,j()}var R;!function(t){t[t.TILES=0]="TILES",t[t.CONNECTIONS=1]="CONNECTIONS",t[t.RESULT=2]="RESULT"}(R||(R={}));const A=Object.keys(R).length/2;let B,M=0,z=R.TILES,P=0;function Y(t,e){B&&(z===R.TILES?B.render(!1,{isolate:t,select:e}):z===R.CONNECTIONS?B.render(!0,{debugConnectionsMode:!0,isolate:t,select:e}):z===R.RESULT&&B.render(!0,{isolate:t,select:e}))}function D(t,e){F(new N({width:t,height:e})),j()}function j(){var t,e,n,o;L?(B=null!==(e=L.getFloorByLevel(null!==(t=L.defaultFloor)&&void 0!==t?t:0))&&void 0!==e?e:L.getFloorByIndex(0),M=null!==(o=L.getIndexByLevel(null!==(n=L.defaultFloor)&&void 0!==n?n:0))&&void 0!==o?o:0,I.level.value=B.level.toString(),Y(),xt.bind()):console.warn("Tried to load an area without first initializing it!")}function $(t,e){B&&z===R.TILES&&(B.setTile(t,e,P),xt.setTile(t,e,P))}function X(t,e,n,o){if(B&&z===R.TILES){if(n<t){const e=t;t=n,n=e}if(o<e){const t=e;e=o,o=t}for(let i=e;i<=o;i++)for(let e=t;e<=n;e++)B.setTile(e,i,P);Y()}}function J(t,e,n,o){if(B&&z===R.TILES){if(Y(),n<t){const e=t;t=n,n=e}if(o<e){const t=e;e=o,o=t}for(let i=e;i<=o;i++)for(let e=t;e<=n;e++)xt.setTile(e,i,P)}}function K(t){var e,n;L?L.resize(null!==(e=t.width)&&void 0!==e?e:L.getWidth(),null!==(n=t.height)&&void 0!==n?n:L.getHeight(),t.offsetX,t.offsetY):F(new N({width:t.width,height:t.height})),Y()}function H(t,e){if(B&&z===R.CONNECTIONS){const n=B.getConnectionByIndex(P);n&&(n.tx=t,n.ty=e,Y())}}function W(){if(B&&z===R.CONNECTIONS){const t=B.getConnectionByIndex(P);if(t){const e="VERTICAL"===t.dir;t.dir=e?"HORIZONTAL":"VERTICAL",Y()}}}function V(t,e){if(B&&z===R.CONNECTIONS){const n=B.getConnectionByIndex(P);if(n){const o="VERTICAL"===n.dir,i=Math.max(t-n.tx+1,1),s=Math.max(e-n.ty+1,1);n.size=o?i:s,console.log(o,i,s),Y()}}}function Z(t,e){if(B&&z===R.RESULT){const n=P<-1?B.getLandmarkByIndex(~P-1):B.getIconByIndex(P);n&&(n.x=t,n.y=e,Y())}}function G(t,e,n){if((!n||z===n)&&B){const n=Math.floor(t/8),o=Math.floor(e/8);z===R.TILES?P=B.getMapIndexByPosition(n,o):z===R.CONNECTIONS?P=B.getConnectionIndexByPosition(n,o):z===R.RESULT&&(P=B.getIconIndexByPosition(t,e))}}function q(t){P=t}function Q(){if(B)if(z===R.TILES)Y([P],P);else if(z===R.CONNECTIONS){const t=B.getConnectionByIndex(P);t&&Y([t.map1+1,t.map2+1],P)}else if(z===R.RESULT){const t=P<-1?B.getLandmarkByIndex(~P-1):B.getIconByIndex(P);t&&Y([t.map+1],P)}}function tt(t,e){xt.movePosition(t,e)}function et(){xt.resetPosition(),xt.setZoom(1)}function nt(t){"number"==typeof t&&t in R?z=t:(z++,z>=A&&(z=0)),P=0,Y()}function ot(t){xt.changeZoom(t)}function it(t){if(L&&B){const e=M+t;e>=0&&e<L.getAmountOfFloors()&&(B=L.getFloorByIndex(e),M=e,I.level.value=B.level.toString(),Y())}}let st=!1,rt=!1,at=!1,lt=0,ct=0,ht=0,dt=0,ut=!1;const ft={Minus:()=>ot(-1),Equal:()=>ot(1),KeyQ:()=>it(-1),KeyE:()=>it(1),ArrowUp:t=>tt(0,t?-100:-50),ArrowDown:t=>tt(0,t?100:50),ArrowLeft:t=>tt(t?-100:-50,0),ArrowRight:t=>tt(t?100:50,0),KeyR:()=>et(),Digit1:()=>nt(R.TILES),Digit2:()=>nt(R.CONNECTIONS),Digit3:()=>nt(R.RESULT)};function pt(t){const e=t.offsetX,n=t.offsetY,o=Math.floor(e/8),i=Math.floor(n/8),s=t.shiftKey;0===t.button?(G(e,n,R.CONNECTIONS),G(e,n,R.RESULT),s?(lt=o,ct=i,ht=o,dt=i,J(o,i,o,i)):$(o,i),st=!0,ut=!1):1===t.button?(t.preventDefault(),t.stopImmediatePropagation(),vt.start(e,n),at=!0):2===t.button&&(wt.start(e,n),rt=!0)}function gt(t){const e=t.offsetX,n=t.offsetY,o=Math.floor(e/8),i=Math.floor(n/8),s=t.shiftKey;st&&(o!==ht&&i!==dt&&(s?(ht=o,dt=i,J(lt,ct,o,i),V(o,i)):($(o,i),H(o,i),Z(e,n))),ut=!0),at&&vt.move(e,n),rt&&wt.move(e,n)}function mt(t){const e=t.offsetX,n=t.offsetY,o=Math.floor(e/8),i=Math.floor(n/8),s=t.shiftKey;st&&(s&&X(lt,ct,o,i),ut||W()),at&&vt.stop(e,n),rt&&wt.stop(e,n),st=!1,at=!1,rt=!1}const vt={lastX:0,lastY:0,start(t,e){this.lastX=t,this.lastY=e},move(t,e){const n=t-this.lastX,o=e-this.lastY;tt(n,o),this.lastX=t-n,this.lastY=e-o},stop(t,e){}},wt={start(t,e){G(t,e),Q()},move(t,e){},stop(t,e){Y()}},yt=new Image;yt.src="tiles.png";const St=new Image;St.src="icons.png";var xt=new class{constructor(){this.container=document.createElement("div"),this.container.classList.add("center"),this.background=document.createElement("canvas"),this.foreground=document.createElement("canvas"),this.container.appendChild(this.background),this.container.appendChild(this.foreground),this.contextBG=this.background.getContext("2d"),this.contextFG=this.foreground.getContext("2d"),this.context=this.contextBG,this.width=8,this.height=8,this.offsetX=0,this.offsetY=0,this.factor=1,this.pushTransform(),this.generateTiles(s.from([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,1,1,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,1,0,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),[1]),this.resetPosition()}setTile(t,e,n,o=!1){this.context&&!this.isOutOfBounds(t,e)&&(this.context.fillStyle=o?"#"+n.toString(16).padStart(6,"0"):i.getColor(n),this.context.fillRect(8*t,8*e,8,8))}drawTile(t,e,n){if(this.context&&!this.isOutOfBounds(t,e))for(const o of n)this.context.drawImage(yt,o[0]||0,o[1]||0,o[2]||8,o[3]||8,8*t+(o[4]||0),8*e+(o[5]||0),o[2]||8,o[3]||8)}drawIcon(t,e,n){var o;if(!(n in Tt))throw`"${n}" is not a valid icon name!`;if(this.context&&!this.isOutOfBounds(t/8,e/8)){const i=Tt[n];null===(o=this.context)||void 0===o||o.drawImage(St,i[0]||0,i[1]||0,i[2]||12,i[3]||12,t+(i[4]||-6),e+(i[5]||-6),i[2]||12,i[3]||12)}}setRenderingMode(t){this.context=t?this.contextFG:this.contextBG}isOutOfBounds(t,e){return t<0||t>=this.width/8||e<0||e>=this.height/8}setSize(t,e){this.width=8*t,this.height=8*e,this.background.width=this.width,this.background.height=this.height,this.foreground.width=this.width,this.foreground.height=this.height,this.container.style.width=this.width+"px",this.container.style.height=this.height+"px"}movePosition(t,e){this.factor>=1&&(this.offsetX+=t,this.offsetY+=e,this.pushTransform())}resetPosition(){this.offsetX=0,this.offsetY=0,this.pushTransform()}setZoom(t){if(t%1!=0)throw`Renderer.setZoom(${t}) was called with a non-integer number!`;this.factor=t,this.pushTransform()}changeZoom(t){if(t%1!=0)throw`Renderer.changeZoom(${t}) was called with a non-integer number!`;this.factor+=t,this.factor<1&&(this.factor=1),this.pushTransform()}pushTransform(){let t=this.factor;t<=0&&(t=Math.abs(1/(t-2))),this.container.style.transform=`translate(-50%, -50%) translate(${this.offsetX}px, ${this.offsetY}px) scale(${t})`}generateTiles(t,e){this.setSize(t.getWidth(),t.getHeight()),t.iterate((t,n,o)=>{e?this.setTile(t,n,e.includes(o)?16777215:0,!0):this.setTile(t,n,o)})}generateTilesAdvanced(t,e){const n=t.getWidth(),o=t.getHeight();this.setSize(n,o);for(let i=0;i<o;i++)for(let s=0;s<n;s++){const r=t.get(s,i);if(void 0!==r)if(0===r||e&&!e.includes(r))this.drawTile(s,i,_t.void);else{const e=0!==i&&t.get(s,i-1)===r,a=i!==o-1&&t.get(s,i+1)===r,l=0!==s&&t.get(s-1,i)===r,c=s!==n-1&&t.get(s+1,i)===r,h=0!==i&&0!==s&&t.get(s-1,i-1)!==r,d=0!==i&&s!==n-1&&t.get(s+1,i-1)!==r,u=i!==o-1&&0!==s&&t.get(s-1,i+1)!==r,f=i!==o-1&&s!==n-1&&t.get(s+1,i+1)!==r;this.drawTile(s,i,_t.tiles[+e<<3|+a<<2|+l<<1|+c]),e&&l&&h&&this.drawTile(s,i,_t.vertex.nw),e&&c&&d&&this.drawTile(s,i,_t.vertex.ne),a&&l&&u&&this.drawTile(s,i,_t.vertex.sw),a&&c&&f&&this.drawTile(s,i,_t.vertex.se)}else console.warn(`Point (${s}, ${i}) was outside of the grid!`)}}drawConnection(t,e,n=!1,o=1){const i=n?"vertical":"horizontal";this.drawTile(t,e,_t.connection[i].main);for(let s=1;s<Math.max(1,o);s++){let o=n?s:0,r=n?0:s,a=n?s-1:0,l=n?0:s-1;this.drawTile(t+o,e+r,_t.connection[i].main),this.drawTile(t+a,e+l,_t.connection[i].extend)}}drawDebugConnection(t,e,n=!1,o=1){if(this.setTile(t,e,16711680,!0),n){this.setTile(t,e+1,65280,!0);for(let n=1;n<o;n++)this.setTile(t+n,e,255,!0),this.setTile(t+n,e+1,255,!0)}else{this.setTile(t+1,e,65280,!0);for(let n=1;n<o;n++)this.setTile(t,e+n,255,!0),this.setTile(t+1,e+n,255,!0)}}getIconBounds(t,e,n){if(!(n in Tt))throw`"${n}" is not a valid icon name!`;const o=Tt[n],i=t+(o[4]||-6),s=e+(o[5]||-6);return[i,s,i+(o[2]||12),s+(o[3]||12)]}bind(){!function(t){t.onmousedown=pt,t.onmousemove=gt,t.onmouseup=mt,t.onmouseleave=mt,window.onwheel=t=>{const e=t.shiftKey;t.deltaY<0?e?it(1):ot(1):t.deltaY>0&&(e?it(-1):ot(-1))},t.oncontextmenu=t=>t.preventDefault(),window.onkeydown=t=>{t.code in ft&&ft[t.code](t.shiftKey)}}(this.container)}attach(){document.body.appendChild(this.container)}};const _t={void:[[0,0,8,8]],voidLarge:[[0,0,16,16]],tiles:[[[40,0]],[[16,0,8,4],[16,12,8,4,0,4]],[[24,0,8,4],[24,12,8,4,0,4]],[[20,0,8,4],[20,12,8,4,0,4]],[[16,0,4,8],[28,0,4,8,4,0]],[[16,0]],[[24,0]],[[20,0]],[[16,8,4,8],[28,8,4,8,4,0]],[[16,8]],[[24,8]],[[20,8]],[[16,4,4,8],[28,4,4,8,4,0]],[[16,4]],[[24,4]],[[20,4]]],vertex:{nw:[[32,0,4,4,0,0]],ne:[[36,0,4,4,4,0]],sw:[[32,4,4,4,0,4]],se:[[36,4,4,4,4,4]]},connection:{vertical:{main:[[40,8,8,2,0,6],[40,10,8,3,0,8]],extend:[[17,3,8,2,4,6],[17,3,8,3,4,8]]},horizontal:{main:[[32,8,3,8,5,0],[35,8,2,8,8,0]],extend:[[17,3,3,8,5,4],[17,3,2,8,8,4]]}}},Tt={arrow_up:[0,0],arrow_down:[12,0],arrow_left:[24,0],arrow_right:[36,0],floor_down:[48,0],weapons:[60,0],quest:[72,0],entrance:[84,0],chest:[96,0],area_up:[0,12],area_down:[12,12],area_left:[24,12],area_right:[36,12],shop:[48,12],trader:[60,12],quest_hub:[72,12],landmark:[84,12,16,16,-7,-8]};xt.attach(),document.body.appendChild(O),document.body.ondrop=function(t){if(t.preventDefault(),t.dataTransfer)for(const e of t.dataTransfer.items){const t=e.getAsFile();if(t&&t.name.endsWith(".json")){x=t.name;const e=new FileReader;e.readAsText(t,"UTF-8"),e.onload=()=>{_(e.result)}}}},document.body.ondragover=t=>t.preventDefault(),Object.assign(window,{Renderer:xt,Gateway:o,Settings:d})}]);